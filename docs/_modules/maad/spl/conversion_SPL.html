

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>maad.spl.conversion_SPL &mdash; scikit-maad 1.5.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css?v=d2d258e8" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=44dfd65d"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            scikit-maad
              <img src="../../../_static/logo_maad_white.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quick start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../audio_dataset.html">Audio dataset</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../sound.html">Sound processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rois.html">Segmentation methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../features.html">Acoustic features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../spl.html">Sound pressure level</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../util.html">Utilities</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Example Gallery</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../_auto_examples/index.html">Example gallery</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">scikit-maad</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">maad.spl.conversion_SPL</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for maad.spl.conversion_SPL</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot; </span>
<span class="sd">Collection of functions to convert audio and voltage data to Sound Pressure </span>
<span class="sd">Level (SPL in Pascal) and Leq (Continuous Equivalent SPL).</span>
<span class="sd">Functions are adapted from the algorithm proposed in </span>
<span class="sd">Merchant, N.D., Fristrup, K.M., Johnson, M.P., Tyack, P.L., Witt, M.J., Blondel, P. and Parks, S.E. (2015), </span>
<span class="sd">Measuring acoustic habitats. Methods Ecol Evol, 6: 257-265. `DOI: 10.1111/2041-210X.12330 &lt;https://doi.org/10.1111/2041-210X.12330&gt;`_</span>
<span class="sd">&quot;&quot;&quot;</span>   
<span class="c1">#</span>
<span class="c1"># Authors:  Juan Sebastian ULLOA &lt;lisofomia@gmail.com&gt;</span>
<span class="c1">#           Sylvain HAUPERT &lt;sylvain.haupert@mnhn.fr&gt;</span>
<span class="c1">#</span>
<span class="c1"># License: New BSD License </span>


<span class="c1">#****************************************************************************</span>
<span class="c1"># -------------------       Load modules           ---------------------------</span>
<span class="c1">#****************************************************************************</span>

<span class="c1"># Import external modules</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span> 
<span class="kn">from</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="kn">import</span> <span class="nb">sum</span><span class="p">,</span> <span class="n">log10</span><span class="p">,</span> <span class="nb">abs</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">sqrt</span>

<span class="c1"># min value</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="n">_MIN_</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">min</span>

<span class="c1">#****************************************************************************</span>
<span class="c1"># -------------------       Functions             ---------------------------</span>
<span class="c1">#****************************************************************************</span>

<span class="c1">#%%</span>
<div class="viewcode-block" id="wav2volt">
<a class="viewcode-back" href="../../../generated/maad.spl.wav2volt.html#maad.spl.wav2volt">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">wav2volt</span> <span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">Vadc</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert an audio signal amplitude to Volts.</span>

<span class="sd">    .. warning::</span>
<span class="sd">       **Important:** Previous versions of this function incorrectly calculated the</span>
<span class="sd">        voltage conversion by omitting the division by 2 for the `Vadc` parameter.</span>
<span class="sd">        This resulted in voltage values that were twice as large as they should.</span>
<span class="sd">        If you want to correct the voltage values obtained with the previous version,</span>
<span class="sd">        you can simply divide the results by 2. </span>
<span class="sd">        In dB SPL, this lead to a 6 dB increase in the calculated sound pressure level.</span>
<span class="sd">        If you want to correct the SPL values obtained with the previous version,</span>
<span class="sd">        you can simply subtract 6 dB from the old results.</span>
<span class="sd">        This has been corrected in the version 1.5.1. Ensure you are using the</span>
<span class="sd">        latest version (&gt;=1.5.1) to obtain accurate voltage values.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wave : ndarray-like or scalar </span>
<span class="sd">        wave should already be normalized between -1 to 1 (depending on the number of bits)</span>
<span class="sd">        take the output of the function sound.load of maad module</span>
<span class="sd">        ndarray-like or scalar containing the raw sound waveform </span>
<span class="sd">        </span>
<span class="sd">    Vadc : scalar, optional, default is 2Vpp (=&gt;+/-1V)</span>
<span class="sd">        Maximal voltage (peak to peak) converted by the analog to digital convertor ADC  </span>
<span class="sd">                </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    volt : ndarray-like or scalar</span>
<span class="sd">        ndarray-like or scalar containing the sound waveform in volt</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; w, fs = maad.sound.load(&#39;../data/cold_forest_daylight.wav&#39;) </span>
<span class="sd">    &gt;&gt;&gt; maad.spl.wav2volt(wave=w, Vadc=2)</span>
<span class="sd">        array([ 0.02155849,  0.02570888,  0.02583096, ..., -0.0082877 ,</span>
<span class="sd">        -0.00219072, -0.00377764])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># force to be ndarray</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
    
    <span class="n">volt</span> <span class="o">=</span><span class="n">wave</span> <span class="o">*</span> <span class="n">Vadc</span><span class="o">/</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">volt</span></div>


<span class="c1">#%%</span>
<div class="viewcode-block" id="volt2pressure">
<a class="viewcode-back" href="../../../generated/maad.spl.volt2pressure.html#maad.spl.volt2pressure">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">volt2pressure</span><span class="p">(</span><span class="n">volt</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">sensitivity</span><span class="o">=-</span><span class="mi">35</span><span class="p">,</span> <span class="n">dBref</span><span class="o">=</span><span class="mi">94</span><span class="p">):</span>  
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert Volts to instantaneous sound pressure (p [Pa]).</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    volt : ndarray-like or scalar</span>
<span class="sd">        ndarray-like or scalar containing the sound waveform in volt</span>
<span class="sd">        </span>
<span class="sd">    gain : integer</span>
<span class="sd">        Total gain applied to the sound (preamplifer + amplifier)</span>
<span class="sd">    </span>
<span class="sd">    sensitivity : float, optional, default is -35 (dB/V)</span>
<span class="sd">        Sensitivity of the microphone</span>
<span class="sd">    </span>
<span class="sd">    dBref : integer, optional, default is 94 (dBSPL)</span>
<span class="sd">        Pressure sound level used for the calibration of the microphone </span>
<span class="sd">        (usually 94dB, sometimes 114dB)</span>
<span class="sd">                </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    p : ndarray-like or scalar</span>
<span class="sd">        ndarray-like or scalar containing the sound waveform in pressure (Pa)</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; w, fs = maad.sound.load(&#39;../data/cold_forest_daylight.wav&#39;) </span>
<span class="sd">    &gt;&gt;&gt; v = maad.spl.wav2volt(wave=w)</span>
<span class="sd">    &gt;&gt;&gt; maad.spl.volt2pressure(volt=v, gain=42) </span>
<span class="sd">        array([ 0.00481491,  0.00574187,  0.00576913, ..., -0.00185099,</span>
<span class="sd">        -0.00097856, -0.00168741])   </span>
<span class="sd">    </span>
<span class="sd">    Same result with the function wav2pressure</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; maad.spl.wav2pressure(wave=w, gain=42)</span>
<span class="sd">        array([ 0.00481491,  0.00574187,  0.00576913, ..., -0.00185099,</span>
<span class="sd">        -0.00097856, -0.00168741])</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># force to be ndarray</span>
    <span class="n">volt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">volt</span><span class="p">)</span>
    
    <span class="c1"># wav to instantaneous sound pressure level (SPL)</span>
    <span class="c1"># coefficient to convert Volt into pressure (Pa)</span>
    <span class="n">coeff</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">sensitivity</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span> 
    <span class="n">p</span> <span class="o">=</span> <span class="n">volt</span> <span class="o">*</span> <span class="n">coeff</span> <span class="o">/</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">gain</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p</span></div>


<span class="c1">#%%</span>
<div class="viewcode-block" id="wav2pressure">
<a class="viewcode-back" href="../../../generated/maad.spl.wav2pressure.html#maad.spl.wav2pressure">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">wav2pressure</span> <span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">Vadc</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sensitivity</span><span class="o">=-</span><span class="mi">35</span><span class="p">,</span> <span class="n">dBref</span><span class="o">=</span><span class="mi">94</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert wave amplitude to instantaneous sound pressure (p [Pa]).</span>

<span class="sd">    .. warning::</span>
<span class="sd">       **Important:** Previous versions of this function incorrectly calculated the</span>
<span class="sd">        pressure conversion by omitting the division by 2 for the `Vadc` parameter.</span>
<span class="sd">        This resulted in pressure values that were twice as large as they should.</span>
<span class="sd">        If you want to correct the pressure values obtained with the previous version,</span>
<span class="sd">        you can simply divide the results by 2. </span>
<span class="sd">        In dB SPL, this would lead to a 6 dB increase in the calculated sound pressure level.</span>
<span class="sd">        If you want to correct the SPL values obtained with the previous version,</span>
<span class="sd">        you can simply subtract 6 dB from the old results.</span>
<span class="sd">        This has been corrected in the version 1.5.1. Ensure you are using the</span>
<span class="sd">        latest version (&gt;=1.5.1) to obtain accurate pressure values.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wave : ndarray-like or scalar </span>
<span class="sd">        wave should already be normalized between -1 to 1 (depending on the number of bits)</span>
<span class="sd">        take the output of the function sound.load of maad module</span>
<span class="sd">        ndarray-like or scalar containing the raw sound waveform </span>
<span class="sd">        </span>
<span class="sd">    gain : integer</span>
<span class="sd">        Total gain applied to the sound (preamplifer + amplifier)</span>
<span class="sd">        </span>
<span class="sd">    Vadc : scalar, optional, default is 2Vpp (=&gt;+/-1V)</span>
<span class="sd">        Maximal voltage (peak to peak) converted by the analog to digital convertor ADC    </span>

<span class="sd">    sensitivity : float, optional, default is -35 (dB/V)</span>
<span class="sd">        Sensitivity of the microphone</span>
<span class="sd">    </span>
<span class="sd">    dBref : integer, optional, default is 94 (dBSPL)</span>
<span class="sd">        Pressure sound level used for the calibration of the microphone </span>
<span class="sd">        (usually 94dB, sometimes 114dB)</span>
<span class="sd">                </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    p : ndarray-like or scalar</span>
<span class="sd">        ndarray-like or scalar containing the sound waveform in pressure (Pa)</span>
<span class="sd">        </span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; w, fs = maad.sound.load(&#39;../data/cold_forest_daylight.wav&#39;) </span>
<span class="sd">    &gt;&gt;&gt; maad.spl.wav2pressure(wave=w, gain=42)</span>
<span class="sd">        array([ 0.00481491,  0.00574187,  0.00576913, ..., -0.00185099,</span>
<span class="sd">        -0.00097856, -0.00168741])</span>
<span class="sd">    </span>
<span class="sd">    Same result with 2 functions</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; v = maad.spl.wav2volt(wave=w)</span>
<span class="sd">    &gt;&gt;&gt; maad.spl.volt2pressure(volt=v, gain=42) </span>
<span class="sd">        array([ 0.00481491,  0.00574187,  0.00576913, ..., -0.00185099,</span>
<span class="sd">        -0.00097856, -0.00168741])        </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># force to be ndarray</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>

    <span class="n">v</span> <span class="o">=</span> <span class="n">wav2volt</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">Vadc</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">volt2pressure</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">sensitivity</span><span class="p">,</span> <span class="n">dBref</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p</span></div>


<span class="c1">#%%</span>
<div class="viewcode-block" id="pressure2dBSPL">
<a class="viewcode-back" href="../../../generated/maad.spl.pressure2dBSPL.html#maad.spl.pressure2dBSPL">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">pressure2dBSPL</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">pRef</span><span class="o">=</span><span class="mf">20e-6</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert sound pressure (p [Pa]) to sound pressure level (L [dB]).</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : ndarray-like or scalar</span>
<span class="sd">        Array or scalar containing the sound pressure in Pa </span>
<span class="sd">                </span>
<span class="sd">    pRef : Sound pressure reference in the medium (air:20e-6 Pa, water:1e-6 Pa)</span>
<span class="sd">                </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    L : ndarray-like or scalar</span>
<span class="sd">        Array or scalar containing the sound pressure level (L [dB])</span>
<span class="sd">        </span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; w, fs = maad.sound.load(&#39;../data/cold_forest_daylight.wav&#39;) </span>
<span class="sd">    &gt;&gt;&gt; p = maad.spl.wav2pressure(wave=w, gain=42)</span>
<span class="sd">    </span>
<span class="sd">    Get instantaneous sound pressure level (L)</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; maad.spl.pressure2dBSPL(abs(p))</span>
<span class="sd">        array([47.63116868, 49.16046498, 49.20160951, ..., 39.32747759,</span>
<span class="sd">        33.79115165, 38.52380598])</span>
<span class="sd">    </span>
<span class="sd">    Get equivalent sound pressure level (Leq) from the RMS of the pressure signal</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; p_rms = maad.util.rms(p)</span>
<span class="sd">    &gt;&gt;&gt; maad.spl.pressure2dBSPL(p_rms)  </span>
<span class="sd">        48.51429086346293</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="c1"># force to be ndarray</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    
    <span class="c1"># if p ==0 set to MIN</span>
    <span class="n">p</span><span class="p">[</span><span class="n">p</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_MIN_</span>
    
    <span class="c1"># Take the log of the ratio pressure/pRef</span>
    <span class="n">L</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">log10</span><span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="n">pRef</span><span class="p">)</span> 
    <span class="k">return</span> <span class="n">L</span></div>


<span class="c1">#%%</span>
<div class="viewcode-block" id="dBSPL2pressure">
<a class="viewcode-back" href="../../../generated/maad.spl.dBSPL2pressure.html#maad.spl.dBSPL2pressure">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">dBSPL2pressure</span> <span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">pRef</span><span class="o">=</span><span class="mf">20e-6</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert sound pressure level (L [dB]) to sound pressure (p [Pa]).</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    L : ndarray-like or scalar</span>
<span class="sd">        Array or scalar containing the sound pressure level (L [dB])</span>
<span class="sd">                </span>
<span class="sd">    pRef : Sound pressure reference in the medium (air:20e-6 Pa, water:1e-6 Pa)</span>
<span class="sd">                </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    p : ndarray-like or scalar</span>
<span class="sd">        Array or scalar containing the sound pressure in Pa </span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; w, fs = maad.sound.load(&#39;../data/cold_forest_daylight.wav&#39;) </span>
<span class="sd">    &gt;&gt;&gt; p = maad.spl.wav2pressure(wave=w, gain=42)</span>
<span class="sd">    &gt;&gt;&gt; p_rms = maad.util.rms(p)</span>
<span class="sd">    &gt;&gt;&gt; print(p_rms)</span>
<span class="sd">        0.0053302126891706676</span>
<span class="sd">    &gt;&gt;&gt; L = maad.spl.pressure2dBSPL(p_rms)  </span>
<span class="sd">    &gt;&gt;&gt; maad.spl.dBSPL2pressure(L)</span>
<span class="sd">        spl.dBSPL2pressure(L)</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="c1"># force to be ndarray</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
    
    <span class="c1"># dB SPL to pressure</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span><span class="o">*</span><span class="n">pRef</span>
    <span class="k">return</span> <span class="n">p</span></div>


<span class="c1">#%%</span>
<div class="viewcode-block" id="wav2dBSPL">
<a class="viewcode-back" href="../../../generated/maad.spl.wav2dBSPL.html#maad.spl.wav2dBSPL">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">wav2dBSPL</span> <span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">Vadc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sensitivity</span><span class="o">=-</span><span class="mi">35</span><span class="p">,</span> <span class="n">dBref</span><span class="o">=</span><span class="mi">94</span><span class="p">,</span> <span class="n">pRef</span><span class="o">=</span><span class="mf">20e-6</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert wave amplitude to instantaneous sound pressure level (L [dB SPL]).</span>

<span class="sd">    .. warning::</span>
<span class="sd">       **Important:** Previous versions of this function incorrectly calculated the</span>
<span class="sd">        pressure conversion by omitting the division by 2 for the `Vadc` parameter.</span>
<span class="sd">        In dB SPL, this would lead to a 6 dB increase in the calculated sound pressure level.</span>
<span class="sd">        If you want to correct the SPL values obtained with the previous version,</span>
<span class="sd">        you can simply subtract 6 dB from the old results.</span>
<span class="sd">        This has been corrected in the version 1.5.1. Ensure you are using the</span>
<span class="sd">        latest version (&gt;=1.5.1) to obtain accurate dB SPL values.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wave : ndarray-like or scalar </span>
<span class="sd">        wave should already be normalized between -1 to 1 (depending on the number of bits)</span>
<span class="sd">        take the output of the function sound.load of maad module</span>
<span class="sd">        ndarray-like or scalar containing the raw sound waveform </span>
<span class="sd">        </span>
<span class="sd">    gain : integer</span>
<span class="sd">        Total gain applied to the sound (preamplifer + amplifier)</span>
<span class="sd">        </span>
<span class="sd">    Vadc : scalar, optional, default is 2Vpp (=&gt;+/-1V)</span>
<span class="sd">        Maximal voltage (peak to peak) converted by the analog to digital convertor ADC     </span>

<span class="sd">    sensitivity : float, optional, default is -35 (dB/V)</span>
<span class="sd">        Sensitivity of the microphone</span>
<span class="sd">    </span>
<span class="sd">    dBref : integer, optional, default is 94 (dBSPL)</span>
<span class="sd">        Pressure sound level used for the calibration of the microphone </span>
<span class="sd">        (usually 94dB, sometimes 114dB)</span>
<span class="sd">        </span>
<span class="sd">    pRef : Sound pressure reference in the medium (air:20e-6 Pa, water:1e-6 Pa)</span>
<span class="sd">                </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    L : ndarray-like or scalar</span>
<span class="sd">        ndarray-like or scalar containing the sound waveform in dB SPL (Sound Pressure level in dB)</span>
<span class="sd">        </span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; w, fs = maad.sound.load(&#39;../data/cold_forest_daylight.wav&#39;) </span>
<span class="sd">    &gt;&gt;&gt; L = maad.spl.wav2dBSPL(wave=w, gain=42)</span>
<span class="sd">    </span>
<span class="sd">    Get an approximate of the equivalent sound pressure level (Leq)</span>
<span class="sd">        </span>
<span class="sd">    &gt;&gt;&gt; maad.util.mean_dB(L)</span>
<span class="sd">        48.51429086346294</span>
<span class="sd">        </span>
<span class="sd">    Get equivalent sound pressure level (Leq) from the dedicated function</span>
<span class="sd">        </span>
<span class="sd">    &gt;&gt;&gt; Leq = maad.spl.wav2leq(w, fs, gain=42, dt=1)</span>
<span class="sd">    &gt;&gt;&gt; Leq_mean = maad.util.mean_dB(Leq)</span>
<span class="sd">    &gt;&gt;&gt; Leq_mean</span>
<span class="sd">        48.55488267086038</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>       
    <span class="c1"># force to be ndarray</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
    
    <span class="n">p</span> <span class="o">=</span> <span class="n">wav2pressure</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">Vadc</span><span class="p">,</span> <span class="n">sensitivity</span><span class="p">,</span> <span class="n">dBref</span><span class="p">)</span>
    <span class="n">p_abs</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">pressure2dBSPL</span><span class="p">(</span><span class="n">p_abs</span><span class="p">,</span> <span class="n">pRef</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">L</span></div>


<span class="c1">#%%</span>
<div class="viewcode-block" id="amplitude2dBSPL">
<a class="viewcode-back" href="../../../generated/maad.spl.amplitude2dBSPL.html#maad.spl.amplitude2dBSPL">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">amplitude2dBSPL</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">Vadc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sensitivity</span><span class="o">=-</span><span class="mi">35</span><span class="p">,</span> <span class="n">dBref</span><span class="o">=</span><span class="mi">94</span><span class="p">,</span> <span class="n">pRef</span><span class="o">=</span><span class="mf">20e-6</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert signal (amplitude) to instantaneous sound pressure level (L [dB SPL]).</span>

<span class="sd">    .. warning::</span>
<span class="sd">       **Important:** Previous versions of this function incorrectly calculated the</span>
<span class="sd">        volt conversion by omitting the division by 2 for the `Vadc` parameter.</span>
<span class="sd">        In dB SPL, this would lead to a 6 dB increase in the calculated sound pressure level.</span>
<span class="sd">        If you want to correct the SPL values obtained with the previous version,</span>
<span class="sd">        you can simply subtract 6 dB from the old results.</span>
<span class="sd">        This has been corrected in the version 1.5.1. Ensure you are using the</span>
<span class="sd">        latest version (&gt;=1.5.1) to obtain accurate dB SPL values.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s : ndarray-like or scalar </span>
<span class="sd">        s is an amplitude signal (not energy signal : s² )</span>
<span class="sd">        </span>
<span class="sd">    gain : integer</span>
<span class="sd">        Total gain applied to the sound (preamplifer + amplifier)</span>
<span class="sd">        </span>
<span class="sd">    Vadc : scalar, optional, default is 2Vpp (=&gt;+/-1V)</span>
<span class="sd">        Maximal voltage (peak to peak) converted by the analog to digital convertor ADC     </span>

<span class="sd">    sensitivity : float, optional, default is -35 (dB/V)</span>
<span class="sd">        Sensitivity of the microphone</span>
<span class="sd">    </span>
<span class="sd">    dBref : integer, optional, default is 94 (dBSPL)</span>
<span class="sd">        Pressure sound level used for the calibration of the microphone </span>
<span class="sd">        (usually 94dB, sometimes 114dB)</span>
<span class="sd">        </span>
<span class="sd">    pRef : Sound pressure reference in the medium (air:20e-6 Pa, water:1e-6 Pa)</span>
<span class="sd">                </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    L : ndarray-like or scalar</span>
<span class="sd">        ndarray-like or scalar containing the sound waveform in dB SPL (Sound Pressure level in dB)</span>
<span class="sd">    </span>
<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    power2dBSPL</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; w, fs = maad.sound.load(&#39;../data/cold_forest_daylight.wav&#39;) </span>
<span class="sd">    &gt;&gt;&gt; Sxx_amplitude,tn,fn,_ = maad.sound.spectrogram (w, fs, nperseg=1024, mode=&#39;amplitude&#39;)  </span>
<span class="sd">    &gt;&gt;&gt; S_amplitude_mean = np.mean(Sxx_amplitude, axis=1)</span>
<span class="sd">    </span>
<span class="sd">    Get instantaneous sound pressure level (L).</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; maad.spl.amplitude2dBSPL(S_amplitude_mean, gain=42)    </span>
<span class="sd">        array([ 33.54362056,  38.35057445,  35.93645686,  33.5848702 ,</span>
<span class="sd">                30.41177332,  27.22906075,  25.42079962,  24.42677998,</span>
<span class="sd">                22.89529647,  21.24902085,  20.75161999,  20.25268302,</span>
<span class="sd">                ...</span>
<span class="sd">                -12.18064124, -12.32827014, -12.48541472, -12.51967103,</span>
<span class="sd">                -12.54814367, -12.54536435, -12.75677825, -12.77745939])</span>
<span class="sd">    &quot;&quot;&quot;</span>       
    <span class="c1"># force to be ndarray</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    
    <span class="n">L</span> <span class="o">=</span> <span class="n">wav2dBSPL</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">Vadc</span><span class="p">,</span> <span class="n">sensitivity</span><span class="p">,</span> <span class="n">dBref</span><span class="p">,</span> <span class="n">pRef</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">L</span></div>



<span class="c1">#%%</span>
<div class="viewcode-block" id="power2dBSPL">
<a class="viewcode-back" href="../../../generated/maad.spl.power2dBSPL.html#maad.spl.power2dBSPL">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">power2dBSPL</span> <span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">Vadc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sensitivity</span><span class="o">=-</span><span class="mi">35</span><span class="p">,</span> <span class="n">dBref</span><span class="o">=</span><span class="mi">94</span><span class="p">,</span> <span class="n">pRef</span><span class="o">=</span><span class="mf">20e-6</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert power (amplitude²) to sound pressure level (L [dB]).</span>

<span class="sd">    .. warning::</span>
<span class="sd">       **Important:** Previous versions of this function incorrectly calculated the</span>
<span class="sd">        volt conversion by omitting the division by 2 for the `Vadc` parameter.</span>
<span class="sd">        In dB SPL, this would lead to a 6 dB increase in the calculated sound pressure level.</span>
<span class="sd">        If you want to correct the SPL values obtained with the previous version,</span>
<span class="sd">        you can simply subtract 6 dB from the old results.</span>
<span class="sd">        This has been corrected in the version 1.5.1. Ensure you are using the</span>
<span class="sd">        latest version (&gt;=1.5.1) to obtain accurate dB SPL values.    </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    P : ndarray-like or scalar</span>
<span class="sd">        ndarray-like or scalar containing the power signal (P), for instance </span>
<span class="sd">        Sxx_power, the power spectral density (PSD)</span>

<span class="sd">    gain : integer</span>
<span class="sd">        Total gain applied to the sound (preamplifer + amplifier)</span>
<span class="sd">        </span>
<span class="sd">    Vadc : scalar, optional, default is 2Vpp (=&gt;+/-1V)</span>
<span class="sd">        Maximal voltage (peak to peak) converted by the analog to digital convertor ADC     </span>

<span class="sd">    sensitivity : float, optional, default is -35 (dB/V)</span>
<span class="sd">        Sensitivity of the microphone</span>
<span class="sd">    </span>
<span class="sd">    dBref : integer, optional, default is 94 (dBSPL)</span>
<span class="sd">        Pressure sound level used for the calibration of the microphone </span>
<span class="sd">        (usually 94dB, sometimes 114dB)</span>
<span class="sd">                </span>
<span class="sd">    pRef : Sound pressure reference in the medium (air:20e-6 Pa, water:1e-6 Pa)</span>
<span class="sd">                </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    L : ndarray-like or scalar</span>
<span class="sd">        ndarray-like or scalar containing the sound pressure level (L [dB])</span>
<span class="sd">        </span>
<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    amplitude2dBSPL</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; w, fs = maad.sound.load(&#39;../data/cold_forest_daylight.wav&#39;) </span>
<span class="sd">    &gt;&gt;&gt; Sxx_power,tn,fn,_ = maad.sound.spectrogram (w, fs, nperseg=1024, mode=&#39;psd&#39;)  </span>
<span class="sd">    &gt;&gt;&gt; S_power_mean = np.mean(Sxx_power, axis=1)</span>
<span class="sd">    </span>
<span class="sd">    Get instantaneous sound pressure level (L).</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; maad.spl.power2dBSPL(S_power_mean, gain=42)    </span>
<span class="sd">        array([ 3.55439604e+01,  3.94219755e+01,  3.71509454e+01,  3.54860553e+01,</span>
<span class="sd">                3.20633292e+01,  2.85071055e+01,  2.65508217e+01,  2.56607733e+01,</span>
<span class="sd">                2.43080132e+01,  2.24405108e+01,  2.18647044e+01,  2.14653511e+01,</span>
<span class="sd">                ...</span>
<span class="sd">                -1.11242771e+01, -1.12703297e+01, -1.14085678e+01, -1.14487227e+01,</span>
<span class="sd">                -1.14906343e+01, -1.14980091e+01, -1.16907591e+01, -1.17027481e+01])</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="c1"># force to be ndarray</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
    <span class="c1"># convert power (energy) to amplitude</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
    <span class="c1"># convert amplitude to dB sPL</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">wav2dBSPL</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">Vadc</span><span class="p">,</span> <span class="n">sensitivity</span><span class="p">,</span> <span class="n">dBref</span><span class="p">,</span> <span class="n">pRef</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">L</span></div>


<span class="c1">################################## Leq ########################################</span>
<span class="c1">#%%</span>
<div class="viewcode-block" id="wav2leq">
<a class="viewcode-back" href="../../../generated/maad.spl.wav2leq.html#maad.spl.wav2leq">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">wav2leq</span> <span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">Vadc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sensitivity</span><span class="o">=-</span><span class="mi">35</span><span class="p">,</span> <span class="n">dBref</span> <span class="o">=</span> <span class="mi">94</span><span class="p">,</span> <span class="n">pRef</span> <span class="o">=</span> <span class="mf">20e-6</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert wave to Equivalent Continuous Sound Pressure level (Leq [dB SPL]).</span>

<span class="sd">    .. warning::</span>
<span class="sd">       **Important:** Previous versions of this function incorrectly calculated the</span>
<span class="sd">        volt conversion by omitting the division by 2 for the `Vadc` parameter.</span>
<span class="sd">        In dB SPL, this would lead to a 6 dB increase in the calculated sound pressure level.</span>
<span class="sd">        If you want to correct the SPL values obtained with the previous version,</span>
<span class="sd">        you can simply subtract 6 dB from the old results.</span>
<span class="sd">        This has been corrected in the version 1.5.1. Ensure you are using the</span>
<span class="sd">        latest version (&gt;=1.5.1) to obtain accurate dB SPL values. </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wave : ndarray-like or scalar </span>
<span class="sd">        wave should already be normalized between -1 to 1 (depending on the number of bits)</span>
<span class="sd">        take the output of the function sound.load of maad module</span>
<span class="sd">        ndarray-like or scalar containing the raw sound waveform </span>
<span class="sd">        </span>
<span class="sd">    f : integer</span>
<span class="sd">        Sampling frequency in Hz</span>
<span class="sd">        </span>
<span class="sd">    gain : integer</span>
<span class="sd">        Total gain applied to the sound (preamplifer + amplifier)</span>
<span class="sd">        </span>
<span class="sd">    Vadc : scalar, optional, default is 2Vpp (=&gt;+/-1V)</span>
<span class="sd">        Maximal voltage (peak to peak) converted by the analog to digital convertor ADC  </span>
<span class="sd">        </span>
<span class="sd">    dt : float, optional, default is 1 (second)</span>
<span class="sd">        Integration step to compute the Leq (Equivalent Continuous Sound level)</span>

<span class="sd">    sensitivity : float, optional, default is -35 (dB/V)</span>
<span class="sd">        Sensitivity of the microphone</span>
<span class="sd">    </span>
<span class="sd">    dBref : integer, optional, default is 94 (dBSPL)</span>
<span class="sd">        Pressure sound level used for the calibration of the microphone </span>
<span class="sd">        (usually 94dB, sometimes 114dB)</span>
<span class="sd">    </span>
<span class="sd">    pRef : Sound pressure reference in the medium (air:20e-6, water:1e-6 Pa)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Leq : float</span>
<span class="sd">        Equivalent Continuous Sound pressure level (Leq [dB SPL])</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; w, fs = maad.sound.load(&#39;../data/cold_forest_daylight.wav&#39;) </span>
<span class="sd">    &gt;&gt;&gt; Leq = maad.spl.wav2leq (w, fs, gain=42)  </span>
<span class="sd">    &gt;&gt;&gt; maad.util.mean_dB(Leq)</span>
<span class="sd">        48.55488267086038</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="c1"># force to be ndarray</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
    
    <span class="c1"># convert in Volt</span>
    <span class="n">volt</span> <span class="o">=</span> <span class="n">wav2volt</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">Vadc</span><span class="p">)</span>
    <span class="c1">##### volt amplitude to Leq </span>
    <span class="c1"># wav to RMS</span>
    <span class="n">dN</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="n">f</span><span class="p">))</span> <span class="c1"># RMS period in number of points</span>
    <span class="n">N_RMS</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">volt</span><span class="p">)</span><span class="o">/</span><span class="n">dN</span><span class="p">))</span> <span class="c1"># number of RMS periods</span>
    <span class="c1"># reduction of volt vector length</span>
    <span class="n">volt_1D</span> <span class="o">=</span> <span class="n">volt</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">dN</span><span class="o">*</span><span class="n">N_RMS</span><span class="p">]</span>
    <span class="c1"># reshape into 2D (the duration of each row is dt)</span>
    <span class="n">volt_2D</span> <span class="o">=</span> <span class="n">volt_1D</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">N_RMS</span><span class="p">,</span><span class="n">dN</span><span class="p">)</span>
    <span class="c1"># RMS</span>
    <span class="n">volt_RMS</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">volt_2D</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="c1"># if volt_RMS ==0 set to MIN</span>
    <span class="n">volt_RMS</span><span class="p">[</span><span class="n">volt_RMS</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_MIN_</span>
    <span class="c1"># RMS to Leq (Equivalent Continuous Sound level)</span>
    <span class="n">Leq</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">log10</span><span class="p">(</span><span class="n">volt_RMS</span><span class="p">)</span> <span class="o">-</span> <span class="n">sensitivity</span> <span class="o">-</span> <span class="n">gain</span> <span class="o">+</span> <span class="n">dBref</span> <span class="o">-</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pRef</span><span class="o">/</span><span class="mf">20e-6</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Leq</span></div>


<span class="c1">#%%</span>
<div class="viewcode-block" id="pressure2leq">
<a class="viewcode-back" href="../../../generated/maad.spl.pressure2leq.html#maad.spl.pressure2leq">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">pressure2leq</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">pRef</span> <span class="o">=</span> <span class="mf">20e-6</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert pressure vector (p [Pa]) to Equivalent Continuous Sound Pressure </span>
<span class="sd">    level (Leq [dB SPL]).</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : ndarray-like</span>
<span class="sd">        Array containing the sound pressure in Pa </span>
<span class="sd">        </span>
<span class="sd">    fs : integer</span>
<span class="sd">        Sampling frequency in Hz</span>
<span class="sd">        </span>
<span class="sd">    dt : float, optional, default is 1 (second)</span>
<span class="sd">        Integration step to compute the Leq (Equivalent Continuous Sound level)</span>

<span class="sd">    pRef : Sound pressure reference in the medium (air:20e-6, water:1e-6 Pa)</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Leq : float</span>
<span class="sd">        Equivalent Continuous Sound pressure level (Leq [dB SPL])</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; w, fs = maad.sound.load(&#39;../data/cold_forest_daylight.wav&#39;) </span>
<span class="sd">    &gt;&gt;&gt; p = maad.spl.wav2pressure(wave=w, gain=42)</span>
<span class="sd">    &gt;&gt;&gt; Leq = maad.spl.pressure2leq (p, fs)</span>
<span class="sd">    &gt;&gt;&gt; maad.util.mean_dB(Leq)</span>
<span class="sd">        48.534282757580755</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>     
    <span class="c1"># be sure they are ndarray</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    
    <span class="c1">##### wav SPLto Leq </span>
    <span class="c1"># wav to RMS</span>
    <span class="n">dN</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="n">fs</span><span class="p">))</span> <span class="c1"># RMS period in number of points</span>
    <span class="n">N_RMS</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">dN</span><span class="p">))</span> <span class="c1"># number of RMS periods</span>
    <span class="c1"># reduction of volt vector length</span>
    <span class="n">p_1D</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">dN</span><span class="o">*</span><span class="n">N_RMS</span><span class="p">]</span>
    <span class="c1"># reshape into 2D (the duration of each row is dt)</span>
    <span class="n">p_2D</span> <span class="o">=</span> <span class="n">p_1D</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">N_RMS</span><span class="p">,</span><span class="n">dN</span><span class="p">)</span>
    <span class="c1"># RMS</span>
    <span class="n">p_RMS</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">p_2D</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="c1"># if p_RMS ==0 set to MIN</span>
    <span class="n">p_RMS</span><span class="p">[</span><span class="n">p_RMS</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_MIN_</span>
    <span class="c1"># RMS to Leq (Equivalent Continuous Sound level)</span>
    <span class="n">Leq</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">log10</span><span class="p">(</span><span class="n">p_RMS</span><span class="o">/</span><span class="n">pRef</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Leq</span></div>


<span class="c1">#%%</span>
<div class="viewcode-block" id="psd2leq">
<a class="viewcode-back" href="../../../generated/maad.spl.psd2leq.html#maad.spl.psd2leq">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">psd2leq</span> <span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">Vadc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sensitivity</span><span class="o">=-</span><span class="mi">35</span><span class="p">,</span> <span class="n">dBref</span> <span class="o">=</span> <span class="mi">94</span><span class="p">,</span> <span class="n">pRef</span> <span class="o">=</span> <span class="mf">20e-6</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert Power spectral density (PSD, amplitude²) into </span>
<span class="sd">    Equivalent Continuous Sound pressure level (Leq [dB SPL])</span>

<span class="sd">    .. warning::</span>
<span class="sd">       **Important:** Previous versions of this function incorrectly calculated the</span>
<span class="sd">        volt conversion by omitting the division by 2 for the `Vadc` parameter.</span>
<span class="sd">        In dB SPL, this would lead to a 6 dB increase in the calculated sound pressure level.</span>
<span class="sd">        If you want to correct the SPL values obtained with the previous version,</span>
<span class="sd">        you can simply subtract 6 dB from the old results.</span>
<span class="sd">        This has been corrected in the version 1.5.1. Ensure you are using the</span>
<span class="sd">        latest version (&gt;=1.5.1) to obtain accurate dB SPL values. </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    P : ndarray-like (1d)</span>
<span class="sd">        ndarray-like containing the Power spectral density (PSD=amplitude²) </span>
<span class="sd">        </span>
<span class="sd">    gain : integer</span>
<span class="sd">        Total gain applied to the sound (preamplifer + amplifier)</span>
<span class="sd">        </span>
<span class="sd">    Vadc : scalar, optional, default is 2Vpp (=&gt;+/-1V)</span>
<span class="sd">        Maximal voltage (peak to peak) converted by the analog to digital convertor ADC  </span>

<span class="sd">    sensitivity : float, optional, default is -35 (dB/V)</span>
<span class="sd">        Sensitivity of the microphone</span>
<span class="sd">    </span>
<span class="sd">    dBref : integer, optional, default is 94 (dBSPL)</span>
<span class="sd">        Pressure sound level used for the calibration of the microphone </span>
<span class="sd">        (usually 94dB, sometimes 114dB)</span>

<span class="sd">    pRef : Sound pressure reference in the medium (air:20e-6, water:1e-6 Pa)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Leq : float</span>
<span class="sd">        Equivalent Continuous Sound pressure level (Leq [dB SPL])</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; w, fs = maad.sound.load(&#39;../data/cold_forest_daylight.wav&#39;) </span>
<span class="sd">    &gt;&gt;&gt; Sxx_power,tn,fn,_ = maad.sound.spectrogram (w, fs)</span>
<span class="sd">    &gt;&gt;&gt; S_power_mean = maad.sound.avg_power_spectro(Sxx_power) </span>
<span class="sd">    &gt;&gt;&gt; maad.spl.psd2leq(S_power_mean, gain=42)</span>
<span class="sd">        47.537824826354665</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>  
    <span class="c1"># be sure they are ndarray</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
    
    <span class="c1"># convert P (amplitude²) to pressure²</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">wav2pressure</span> <span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">P</span><span class="p">),</span> <span class="n">gain</span><span class="p">,</span> <span class="n">Vadc</span><span class="p">,</span> <span class="n">sensitivity</span><span class="p">,</span> <span class="n">dBref</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    
    <span class="c1"># if P ==0 set to MIN</span>
    <span class="n">P</span><span class="p">[</span><span class="n">P</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_MIN_</span>
    
    <span class="c1"># Energy (pressure^2) to Leq (=&gt; Leq (Equivalent Continuous Sound level) </span>
    <span class="c1"># if the sum is performed on the whole PSD)</span>
    <span class="n">Leq</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">log10</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">P</span><span class="p">)</span><span class="o">/</span><span class="n">pRef</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Leq</span></div>

    
<span class="c1">################################ TEST ########################################</span>
    
<span class="c1">## Test the current operating system</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># ############## Import MAAD module</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span> <span class="c1"># in order to be Windows/Linux/MacOS compatible</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
    
    <span class="c1"># change the path to the current path where the script is located</span>
    <span class="c1"># Get the current dir of the current file</span>
    <span class="n">dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="s1">&#39;__file__&#39;</span><span class="p">))</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
    
    <span class="c1"># data directory </span>
    <span class="n">datadir</span> <span class="o">=</span> <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="s2">&quot;data/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">datadir</span><span class="o">/</span><span class="s2">&quot;cold_forest_daylight.wav&quot;</span>
    
    <span class="c1"># Go to the root directory where is the module maad and import maad</span>
    <span class="n">maad_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">os</span><span class="o">.</span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">maad_path</span><span class="o">.</span><span class="n">as_posix</span><span class="p">())</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">maad</span><span class="w"> </span><span class="kn">import</span> <span class="n">sound</span><span class="p">,</span> <span class="n">util</span><span class="p">,</span> <span class="n">spl</span>
    
    <span class="c1">####### Variables</span>
    <span class="n">SENSITIVITY</span>     <span class="o">=</span> <span class="o">-</span><span class="mi">35</span>       <span class="c1"># Sensbility microphone (for SM4 it is -35dBV)</span>
    <span class="n">GAIN_TOTAL</span>      <span class="o">=</span> <span class="mi">42</span>        <span class="c1"># total amplification gain : preamplifier gain = 26dB and gain = 16dB</span>
    <span class="n">PREF</span>            <span class="o">=</span> <span class="mf">20e-6</span>     <span class="c1"># Reference pressure (in the air : 20µPa)</span>
    <span class="n">DELTA_T</span>         <span class="o">=</span> <span class="mi">1</span>         <span class="c1"># Leq integration time dt in s</span>
    <span class="n">NFFT</span>            <span class="o">=</span> <span class="mi">1024</span>      <span class="c1"># length of the fft</span>
    <span class="n">VADC</span>            <span class="o">=</span> <span class="mi">2</span>         <span class="c1"># Maximal voltage (peak to peak) converted by the analog to digital convertor ADC (i.e : +/- 1V peak to peak =&gt; Vadc=2V)</span>
    
    <span class="c1"># Load the sound</span>
    <span class="n">wav</span><span class="p">,</span><span class="n">fs</span> <span class="o">=</span> <span class="n">sound</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">detrend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="c1">## conversion into dB SPL </span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-------------------------------------------------------------------------&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Leq calculation directly from the sound file (in time or frequency domain)&#39;</span><span class="p">)</span>

    <span class="c1"># convert sounds (wave) into SPL and subtract DC offset</span>
    <span class="n">wav</span> <span class="o">=</span> <span class="n">wav</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wav</span><span class="p">)</span>
    <span class="c1"># wav -&gt; pressure -&gt; Leq</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">spl</span><span class="o">.</span><span class="n">wav2pressure</span><span class="p">(</span><span class="n">wav</span><span class="p">,</span> <span class="n">gain</span><span class="o">=</span><span class="n">GAIN_TOTAL</span><span class="p">,</span> <span class="n">Vadc</span><span class="o">=</span><span class="n">VADC</span><span class="p">,</span> <span class="n">sensitivity</span><span class="o">=</span><span class="n">SENSITIVITY</span><span class="p">,</span> <span class="n">dBref</span><span class="o">=</span><span class="mi">94</span><span class="p">)</span>
    <span class="n">Leq</span> <span class="o">=</span> <span class="n">spl</span><span class="o">.</span><span class="n">pressure2leq</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">DELTA_T</span><span class="p">,</span> <span class="n">pRef</span><span class="o">=</span><span class="n">PREF</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Leq from volt&#39;</span><span class="p">,</span> <span class="n">util</span><span class="o">.</span><span class="n">mean_dB</span><span class="p">(</span><span class="n">Leq</span><span class="p">))</span>

    <span class="c1"># wav -&gt; Leq</span>
    <span class="n">wav_Leq2</span> <span class="o">=</span> <span class="n">spl</span><span class="o">.</span><span class="n">wav2leq</span><span class="p">(</span><span class="n">wav</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">gain</span><span class="o">=</span><span class="n">GAIN_TOTAL</span><span class="p">,</span> <span class="n">Vadc</span><span class="o">=</span><span class="n">VADC</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">DELTA_T</span><span class="p">,</span> 
                    <span class="n">sensitivity</span><span class="o">=</span><span class="n">SENSITIVITY</span><span class="p">,</span> <span class="n">dBref</span><span class="o">=</span><span class="mi">94</span><span class="p">,</span> <span class="n">pRef</span><span class="o">=</span><span class="n">PREF</span><span class="p">)</span> 
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Leq from wav&#39;</span><span class="p">,</span> <span class="n">util</span><span class="o">.</span><span class="n">mean_dB</span><span class="p">(</span><span class="n">wav_Leq2</span><span class="p">))</span>

    <span class="c1"># Power Density Spectrum : PSD</span>
    <span class="c1"># with wav</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">fft</span>
    <span class="n">P</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">wav</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">wav</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
    <span class="c1"># average Leq from PSD</span>
    <span class="n">P_Leq3</span>  <span class="o">=</span> <span class="n">spl</span><span class="o">.</span><span class="n">psd2leq</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">gain</span><span class="o">=</span><span class="n">GAIN_TOTAL</span><span class="p">,</span> <span class="n">Vadc</span><span class="o">=</span><span class="n">VADC</span><span class="p">,</span> 
                    <span class="n">sensitivity</span><span class="o">=</span><span class="n">SENSITIVITY</span><span class="p">,</span> <span class="n">dBref</span><span class="o">=</span><span class="mi">94</span><span class="p">,</span> <span class="n">pRef</span><span class="o">=</span><span class="n">PREF</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Leq from PSD&#39;</span><span class="p">,</span><span class="n">P_Leq3</span><span class="p">)</span>

    <span class="c1">##</span>
    <span class="c1"># Leq from spectrogram Sxx_power : </span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-------------------------------------------------------------------------&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Leq calculation from Spectrogram (time-frequency representation of a sound)&#39;</span><span class="p">)</span>

    <span class="c1"># Power Density Spectrogram : Sxx_power</span>
    <span class="c1"># with wav</span>
    <span class="n">Sxx_power</span><span class="p">,</span><span class="n">tn</span><span class="p">,</span><span class="n">fn</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">sound</span><span class="o">.</span><span class="n">spectrogram</span> <span class="p">(</span><span class="n">wav</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="n">NFFT</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;psd&#39;</span><span class="p">)</span>  
    <span class="c1"># Sxx_power to S_power</span>
    <span class="n">S_power</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Sxx_power</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># average Leq from S_power</span>
    <span class="n">P_Leq5</span>  <span class="o">=</span> <span class="n">spl</span><span class="o">.</span><span class="n">psd2leq</span><span class="p">(</span><span class="n">S_power</span><span class="p">,</span> <span class="n">gain</span><span class="o">=</span><span class="n">GAIN_TOTAL</span><span class="p">,</span> <span class="n">Vadc</span><span class="o">=</span><span class="n">VADC</span><span class="p">,</span> 
                    <span class="n">sensitivity</span><span class="o">=</span><span class="n">SENSITIVITY</span><span class="p">,</span> <span class="n">dBref</span><span class="o">=</span><span class="mi">94</span><span class="p">,</span> <span class="n">pRef</span><span class="o">=</span><span class="n">PREF</span><span class="p">)</span> 
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Leq from Sxx_power spectrogram&#39;</span><span class="p">,</span><span class="n">P_Leq5</span><span class="p">)</span>

    <span class="c1"># total energy from S_power</span>
    <span class="n">energy</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">S_power</span><span class="p">)</span>
    <span class="n">P_Leq6</span>  <span class="o">=</span> <span class="n">spl</span><span class="o">.</span><span class="n">wav2dBSPL</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">energy</span><span class="p">),</span> <span class="n">gain</span><span class="o">=</span><span class="n">GAIN_TOTAL</span><span class="p">,</span> <span class="n">Vadc</span><span class="o">=</span><span class="n">VADC</span><span class="p">,</span> 
                    <span class="n">sensitivity</span><span class="o">=</span><span class="n">SENSITIVITY</span><span class="p">,</span> <span class="n">dBref</span><span class="o">=</span><span class="mi">94</span><span class="p">,</span> <span class="n">pRef</span><span class="o">=</span><span class="n">PREF</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Leq from S_power energy&#39;</span><span class="p">,</span><span class="n">P_Leq6</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&gt; The difference with previous Leq calculation is due to the average of &#39;</span><span class="o">+</span> 
            <span class="s1">&#39;the Sxx_power along the time axis which reduces the noise contribution into the total energy.&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&gt; By increasing the NFFT length (i.e. NFFT=4096), Leq value converges towards previous Leq values&#39;</span><span class="p">)</span> 



    
    
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, scikit-maad development team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
         .wy-nav-content { max-width: none; }
  </style>



</body>
</html>