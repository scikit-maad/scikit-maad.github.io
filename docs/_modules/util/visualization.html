

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>util.visualization &mdash; scikit-maad 1.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery-dataframe.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> scikit-maad
          

          
          </a>

          
            
            
              <div class="version">
                1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Quickstart</a></li>
</ul>
<p class="caption"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../sound.html">Sound processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rois.html">Segmentation methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../features.html">Acoustic features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spl.html">Sound pressure level</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../util.html">Utilities</a></li>
</ul>
<p class="caption"><span class="caption-text">Example Gallery</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../_auto_examples/index.html">Example gallery</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">scikit-maad</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>util.visualization</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for util.visualization</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="sd">&quot;&quot;&quot; </span>
<span class="sd">Ensemble of functions that facilitate data visualization.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Import external modules</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LinearSegmentedColormap</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">mpatches</span>
<span class="kn">from</span> <span class="nn">matplotlib.axes</span> <span class="kn">import</span> <span class="n">Axes</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">skimage.io</span> <span class="kn">import</span> <span class="n">imsave</span>
<span class="kn">import</span> <span class="nn">colorsys</span>
<span class="kn">from</span> <span class="nn">ast</span> <span class="kn">import</span> <span class="n">literal_eval</span>

<span class="c1"># min value</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">_MIN_</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">min</span>

<span class="c1"># Importation from internal modules</span>
<span class="kn">from</span> <span class="nn">maad.util</span> <span class="kn">import</span> <span class="n">linear_scale</span><span class="p">,</span> <span class="n">power2dB</span>

<span class="c1">#%%</span>
<span class="k">def</span> <span class="nf">_check_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check if &quot;axes&quot; is an instance of an axis object. If not, use `gca`.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

        <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">Axes</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;`axes` must be an instance of matplotlib.axes.Axes. &quot;</span>
            <span class="s2">&quot;Found type(axes)=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">axes</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">axes</span>


<span class="c1">#%%</span>
<div class="viewcode-block" id="plot_shape"><a class="viewcode-back" href="../../_autosummary/util.visualization.plot_shape.html#util.plot_shape">[docs]</a><span class="k">def</span> <span class="nf">plot_shape</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">display_values</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Plot shape features in a bidimensional plot.</span>
<span class="sd">     </span>
<span class="sd">    Parameters </span>
<span class="sd">    ---------- </span>
<span class="sd">    shape: 1D array, pd.Series or pd.DataFrame </span>
<span class="sd">        Shape features computed with shape_features function. </span>
<span class="sd">     </span>
<span class="sd">    params: pd.DataFrame </span>
<span class="sd">        Pandas dataframe returned by maad.features_rois.shape_features </span>
<span class="sd">     </span>
<span class="sd">    row: int </span>
<span class="sd">        Observation to be visualized </span>
<span class="sd">     </span>
<span class="sd">    display_values: bool </span>
<span class="sd">        Set to True to display the coefficient values. Default is False. </span>
<span class="sd">     </span>
<span class="sd">    Returns </span>
<span class="sd">    ------- </span>
<span class="sd">    ax: matplotlib.axes </span>
<span class="sd">        Axes of the figure </span>
<span class="sd">         </span>
<span class="sd">    Examples </span>
<span class="sd">    -------- </span>
<span class="sd">    &gt;&gt;&gt; from maad.sound import load, spectrogram </span>
<span class="sd">    &gt;&gt;&gt; from maad.features import shape_features, plot_shape </span>
<span class="sd">    &gt;&gt;&gt; import numpy as np </span>
<span class="sd">    &gt;&gt;&gt; s, fs = load(&#39;../data/spinetail.wav&#39;) </span>
<span class="sd">    &gt;&gt;&gt; Sxx, ts, f, ext = spectrogram(s, fs) </span>
<span class="sd">    &gt;&gt;&gt; shape, params = shape_features(np.log10(Sxx), resolution=&#39;high&#39;) </span>
<span class="sd">    &gt;&gt;&gt; plot_shape(shape, params) </span>
<span class="sd"> </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># compute shape of matrix</span>
    <span class="n">dirs_size</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">theta</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">scale_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">pyr_level</span><span class="p">)</span><span class="o">.</span><span class="n">size</span>
    <span class="c1"># reshape feature vector</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="s2">&quot;pyr_level&quot;</span><span class="p">,</span> <span class="s2">&quot;scale&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">index</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">shape_plt</span> <span class="o">=</span> <span class="n">shape</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">shape</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;shp&quot;</span><span class="p">)]</span>
        <span class="n">shape_plt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape_plt</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="n">dirs_size</span><span class="p">,</span> <span class="n">scale_size</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
        <span class="n">shape_plt</span> <span class="o">=</span> <span class="n">shape</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">shape</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;shp&quot;</span><span class="p">)]</span>
        <span class="n">shape_plt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape_plt</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="n">dirs_size</span><span class="p">,</span> <span class="n">scale_size</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">shape_plt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape_plt</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="p">(</span><span class="n">dirs_size</span><span class="p">,</span> <span class="n">scale_size</span><span class="p">))</span>

    <span class="n">unique_scale</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">scale</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">params</span><span class="o">.</span><span class="n">pyr_level</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="c1"># get textlab</span>
    <span class="n">textlab</span> <span class="o">=</span> <span class="n">shape_plt</span>
    <span class="n">textlab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">textlab</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># plot figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
        <span class="n">shape_plt</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">display_values</span><span class="p">:</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="n">textlab</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>

    <span class="n">yticklab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">theta</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">xticklab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">unique_scale</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="n">dirs_size</span><span class="p">,</span> <span class="n">scale_size</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">scale_size</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">xticklab</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dirs_size</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">yticklab</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Scale&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Theta&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">ax</span></div>


<span class="c1">#%%</span>
<div class="viewcode-block" id="overlay_centroid"><a class="viewcode-back" href="../../_autosummary/util.visualization.overlay_centroid.html#util.overlay_centroid">[docs]</a><span class="k">def</span> <span class="nf">overlay_centroid</span><span class="p">(</span><span class="n">im_ref</span><span class="p">,</span> <span class="n">centroid</span><span class="p">,</span> <span class="n">savefig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Overlay centroids on the original spectrogram </span>
<span class="sd">     </span>
<span class="sd">    Parameters </span>
<span class="sd">    ---------- </span>
<span class="sd">    Sxx :  2D array </span>
<span class="sd">        Spectrogram </span>
<span class="sd">               </span>
<span class="sd">    centroid: pandas DataFrame </span>
<span class="sd">        DataFrame with centroid descriptors (centroid_f, centroid_t) </span>
<span class="sd">        Do format_features(rois,tn,fn) before using overlay_centroid to be sure that </span>
<span class="sd">        the format of the DataFrame is correct </span>
<span class="sd">             </span>
<span class="sd">    savefig : string, optional, default is None </span>
<span class="sd">        Root filename (with full path) is required to save the figures. Postfix </span>
<span class="sd">        is added to the root filename. </span>
<span class="sd">         </span>
<span class="sd">    \*\*kwargs, optional. This parameter is used by plt.plot and savefig functions </span>
<span class="sd">            </span>
<span class="sd">        - savefilename : str, optional, default :&#39;_spectro_overlaycentroid.png&#39; </span>
<span class="sd">            Postfix of the figure filename </span>
<span class="sd">         </span>
<span class="sd">        - extent : list of scalars [left, right, bottom, top], optional, default: None</span>
<span class="sd">            The location, in data-coordinates, of the lower-left and</span>
<span class="sd">            upper-right corners. If `None`, the image is positioned such that</span>
<span class="sd">            the pixel centers fall on zero-based (row, column) indices.</span>
<span class="sd">         </span>
<span class="sd">        - title : string, optional, default : &#39;Spectrogram&#39; </span>
<span class="sd">            title of the figure </span>
<span class="sd">         </span>
<span class="sd">        - xlabel : string, optional, default : &#39;Time [s]&#39; </span>
<span class="sd">            label of the horizontal axis </span>
<span class="sd">         </span>
<span class="sd">        - ylabel : string, optional, default : &#39;Amplitude [AU]&#39; </span>
<span class="sd">            label of the vertical axis </span>
<span class="sd">         </span>
<span class="sd">        - cmap : string or Colormap object, optional, default is &#39;gray&#39; </span>
<span class="sd">            See https://matplotlib.org/examples/color/colormaps_reference.html </span>
<span class="sd">            in order to get all the  existing colormaps </span>
<span class="sd">            examples: &#39;hsv&#39;, &#39;hot&#39;, &#39;bone&#39;, &#39;tab20c&#39;, &#39;jet&#39;, &#39;seismic&#39;,  </span>
<span class="sd">            &#39;viridis&#39;... </span>
<span class="sd">         </span>
<span class="sd">        - vmin, vmax : scalar, optional, default: None </span>
<span class="sd">            `vmin` and `vmax` are used in conjunction with norm to normalize </span>
<span class="sd">            luminance data.  Note if you pass a `norm` instance, your </span>
<span class="sd">            settings for `vmin` and `vmax` will be ignored. </span>
<span class="sd">                 </span>
<span class="sd">        - dpi : integer, optional, default is 96 </span>
<span class="sd">            Dot per inch.  </span>
<span class="sd">            For printed version, choose high dpi (i.e. dpi=300) =&gt; slow </span>
<span class="sd">            For screen version, choose low dpi (i.e. dpi=96) =&gt; fast </span>
<span class="sd">         </span>
<span class="sd">        - format : string, optional, default is &#39;png&#39; </span>
<span class="sd">            Format to save the figure  </span>
<span class="sd">         </span>
<span class="sd">        ... and more, see matplotlib  </span>
<span class="sd"> </span>
<span class="sd">    Returns </span>
<span class="sd">    ------- </span>
<span class="sd">    ax  </span>
<span class="sd">        axis object (see matplotlib) </span>
<span class="sd">    fig  </span>
<span class="sd">        figure object (see matplotlib) </span>
<span class="sd"> </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd"> </span>
<span class="sd">    Get centroid from the whole power spectrogram </span>
<span class="sd"> </span>
<span class="sd">    &gt;&gt;&gt; from maad.sound import load, spectrogram</span>
<span class="sd">    &gt;&gt;&gt; from maad.features import centroid_features</span>
<span class="sd">    &gt;&gt;&gt; from maad.util import (power2dB, format_features, overlay_rois, plot2d,</span>
<span class="sd">                               overlay_centroid)</span>
<span class="sd">     </span>
<span class="sd">    Load audio and compute spectrogram </span>
<span class="sd">     </span>
<span class="sd">    &gt;&gt;&gt; s, fs = load(&#39;../data/spinetail.wav&#39;) </span>
<span class="sd">    &gt;&gt;&gt; Sxx,tn,fn,ext = spectrogram(s, fs, db_range=80) </span>
<span class="sd">    &gt;&gt;&gt; Sxx = power2dB(Sxx, db_range=80)</span>
<span class="sd">     </span>
<span class="sd">    Load annotations and plot</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from maad.util import read_audacity_annot</span>
<span class="sd">    &gt;&gt;&gt; rois = read_audacity_annot(&#39;../data/spinetail.txt&#39;) </span>
<span class="sd">    &gt;&gt;&gt; rois = format_features(rois, tn, fn) </span>
<span class="sd">    &gt;&gt;&gt; ax, fig = plot2d (Sxx, extent=ext)</span>
<span class="sd">    &gt;&gt;&gt; ax, fig = overlay_rois(Sxx,rois, extent=ext, ax=ax, fig=fig)</span>
<span class="sd">    </span>
<span class="sd">    Compute the centroid of each rois, format to get results in the </span>
<span class="sd">    temporal and spectral domain and overlay the centroids.</span>
<span class="sd">     </span>
<span class="sd">    &gt;&gt;&gt; centroid = centroid_features(Sxx, rois) </span>
<span class="sd">    &gt;&gt;&gt; centroid = format_features(centroid, tn, fn)</span>
<span class="sd">    &gt;&gt;&gt; ax, fig = overlay_centroid(Sxx,centroid, extent=ext, ax=ax, fig=fig)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check format of the input data</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">centroid</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Rois must be of type pandas DataFrame&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="s2">&quot;centroid_t&quot;</span> <span class="ow">and</span> <span class="s2">&quot;centroid_f&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">centroid</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;Array must be a Pandas DataFrame with column names:(centroid_t, centroid_f). Check example in documentation.&quot;</span>
        <span class="p">)</span>

    <span class="n">ylabel</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;ylabel&quot;</span><span class="p">,</span> <span class="s2">&quot;Frequency [Hz]&quot;</span><span class="p">)</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;xlabel&quot;</span><span class="p">,</span> <span class="s2">&quot;Time [s]&quot;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;ROIs Overlay&quot;</span><span class="p">)</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;cmap&quot;</span><span class="p">,</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>
    <span class="n">extent</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;ext&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">extent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;pseudofrequency [points]&quot;</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;pseudotime [points]&quot;</span>

    <span class="n">vmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;vmin&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;vmax&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;ax&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;fig&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="s2">&quot;firebrick&quot;</span><span class="p">)</span>
    <span class="n">ms</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;ms&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">marker</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;marker&quot;</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">plot2d</span><span class="p">(</span>
                        <span class="n">im_ref</span><span class="p">,</span>
                        <span class="n">extent</span>  <span class="o">=</span> <span class="n">extent</span><span class="p">,</span>
                        <span class="n">now</span>     <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">title</span>   <span class="o">=</span> <span class="n">title</span><span class="p">,</span>
                        <span class="n">ylabel</span>  <span class="o">=</span> <span class="n">ylabel</span><span class="p">,</span>
                        <span class="n">xlabel</span>  <span class="o">=</span> <span class="n">xlabel</span><span class="p">,</span>
                        <span class="n">vmin</span>    <span class="o">=</span> <span class="n">vmin</span><span class="p">,</span>
                        <span class="n">vmax</span>    <span class="o">=</span> <span class="n">vmax</span><span class="p">,</span>
                        <span class="n">cmap</span>    <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span>
                        <span class="o">**</span><span class="n">kwargs</span>
                        <span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">centroid</span><span class="o">.</span><span class="n">centroid_t</span><span class="p">,</span> <span class="n">centroid</span><span class="o">.</span><span class="n">centroid_f</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="c1"># SAVE FIGURE</span>
    <span class="k">if</span> <span class="n">savefig</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dpi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;dpi&quot;</span><span class="p">,</span> <span class="mi">96</span><span class="p">)</span>
        <span class="nb">format</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;format&quot;</span><span class="p">,</span> <span class="s2">&quot;png&quot;</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">,</span> <span class="s2">&quot;_spectro_overlaycentroid&quot;</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">savefig</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nb">format</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ax</span><span class="p">,</span> <span class="n">fig</span></div>


<span class="c1">#%%</span>
<div class="viewcode-block" id="overlay_rois"><a class="viewcode-back" href="../../_autosummary/util.visualization.overlay_rois.html#util.overlay_rois">[docs]</a><span class="k">def</span> <span class="nf">overlay_rois</span><span class="p">(</span><span class="n">im_ref</span><span class="p">,</span> <span class="n">rois</span><span class="p">,</span> <span class="n">savefig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Display bounding boxes with time-frequency regions of interest over a spectrogram.</span>
<span class="sd">    </span>
<span class="sd">    Regions of interest (ROIs) must be provided. They can be loaded as manual annotations or computed using automated methods (see the example section).</span>
<span class="sd">     </span>
<span class="sd">    Parameters </span>
<span class="sd">    ---------- </span>
<span class="sd">    im_ref : 2d ndarray of scalars </span>
<span class="sd">        Spectrogram (or image) </span>
<span class="sd"> </span>
<span class="sd">    rois_bbox : list of tuple (min_y,min_x,max_y,max_x) </span>
<span class="sd">        Contains the bounding box of each ROI </span>
<span class="sd"> </span>
<span class="sd">         </span>
<span class="sd">    savefig : string, optional, default is None </span>
<span class="sd">        Root filename (with full path) is required to save the figures. Postfix </span>
<span class="sd">        is added to the root filename. </span>
<span class="sd">         </span>
<span class="sd">    \*\*kwargs, optional. This parameter is used by plt.plot and savefig functions </span>
<span class="sd">            </span>
<span class="sd">        - savefilename : str, optional, default :&#39;_spectro_overlayrois.png&#39; </span>
<span class="sd">            Postfix of the figure filename </span>
<span class="sd">            </span>
<span class="sd">        - extent : list of scalars [left, right, bottom, top], optional, default: None</span>
<span class="sd">            The location, in data-coordinates, of the lower-left and</span>
<span class="sd">            upper-right corners. If `None`, the image is positioned such that</span>
<span class="sd">            the pixel centers fall on zero-based (row, column) indices.  </span>
<span class="sd">         </span>
<span class="sd">        - title : string, optional, default : &#39;Spectrogram&#39; </span>
<span class="sd">            title of the figure </span>
<span class="sd">         </span>
<span class="sd">        - xlabel : string, optional, default : &#39;Time [s]&#39; </span>
<span class="sd">            label of the horizontal axis </span>
<span class="sd">         </span>
<span class="sd">        - ylabel : string, optional, default : &#39;Amplitude [AU]&#39; </span>
<span class="sd">            label of the vertical axis </span>
<span class="sd">         </span>
<span class="sd">        - cmap : string or Colormap object, optional, default is &#39;gray&#39; </span>
<span class="sd">            See https://matplotlib.org/examples/color/colormaps_reference.html </span>
<span class="sd">            in order to get all the  existing colormaps </span>
<span class="sd">            examples: &#39;hsv&#39;, &#39;hot&#39;, &#39;bone&#39;, &#39;tab20c&#39;, &#39;jet&#39;, &#39;seismic&#39;,  </span>
<span class="sd">            &#39;viridis&#39;... </span>
<span class="sd">         </span>
<span class="sd">        - vmin, vmax : scalar, optional, default: None </span>
<span class="sd">            `vmin` and `vmax` are used in conjunction with norm to normalize </span>
<span class="sd">            luminance data.  Note if you pass a `norm` instance, your </span>
<span class="sd">            settings for `vmin` and `vmax` will be ignored. </span>
<span class="sd">         </span>
<span class="sd">        - dpi : integer, optional, default is 96 </span>
<span class="sd">            Dot per inch.  </span>
<span class="sd">            For printed version, choose high dpi (i.e. dpi=300) =&gt; slow </span>
<span class="sd">            For screen version, choose low dpi (i.e. dpi=96) =&gt; fast </span>
<span class="sd">         </span>
<span class="sd">        - format : string, optional, default is &#39;png&#39; </span>
<span class="sd">            Format to save the figure  </span>
<span class="sd">         </span>
<span class="sd">        ... and more, see matplotlib  </span>
<span class="sd"> </span>
<span class="sd">    Returns </span>
<span class="sd">    ------- </span>
<span class="sd">    ax : axis object (see matplotlib) </span>
<span class="sd">         </span>
<span class="sd">    fig : figure object (see matplotlib) </span>
<span class="sd">    </span>
<span class="sd">    Examples </span>
<span class="sd">    -------- </span>
<span class="sd">    </span>
<span class="sd">    Load audio recording and compute the spectrogram.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; s, fs = maad.sound.load(&#39;../data/cold_forest_daylight.wav&#39;)</span>
<span class="sd">    &gt;&gt;&gt; Sxx,tn,fn,ext = maad.sound.spectrogram (s, fs, fcrop=(0,10000))   </span>

<span class="sd">    Subtract the background noise before finding ROIs.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; Sxx_noNoise = maad.sound.median_equalizer(Sxx)</span>
<span class="sd">    </span>
<span class="sd">    Convert linear spectrogram into dB and smooth.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; Sxx_noNoise_dB = maad.util.power2dB(Sxx_noNoise)         </span>
<span class="sd">    &gt;&gt;&gt; Sxx_noNoise_dB_blurred = maad.sound.smooth(Sxx_noNoise_dB)</span>
<span class="sd">    </span>
<span class="sd">    Detection of the acoustic signature =&gt; creation of a mask</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; im_bin = maad.rois.create_mask(Sxx_noNoise_dB_blurred, bin_std=6, bin_per=0.5, mode=&#39;relative&#39;) </span>
<span class="sd">    </span>
<span class="sd">    Select rois from the mask and display bounding box over the spectrogram without noise.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; im_rois, df_rois = maad.rois.select_rois(im_bin, min_roi=100)  </span>
<span class="sd">    &gt;&gt;&gt; maad.util.overlay_rois (Sxx_noNoise_dB, df_rois, extent=ext,vmin=np.median(Sxx_noNoise_dB), vmax=np.median(Sxx_noNoise_dB)+60) </span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check format of the input data</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">rois</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Rois must be of type pandas DataFrame.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="s2">&quot;min_y&quot;</span> <span class="ow">and</span> <span class="s2">&quot;min_x&quot;</span> <span class="ow">and</span> <span class="s2">&quot;max_y&quot;</span> <span class="ow">and</span> <span class="s2">&quot;max_x&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">rois</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;Array must be a Pandas DataFrame with column names: min_y, min_x, max_y, max_x. Check example in documentation.&quot;</span>
        <span class="p">)</span>

    <span class="n">ylabel</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;ylabel&quot;</span><span class="p">,</span> <span class="s2">&quot;Frequency [Hz]&quot;</span><span class="p">)</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;xlabel&quot;</span><span class="p">,</span> <span class="s2">&quot;Time [s]&quot;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;ROIs Overlay&quot;</span><span class="p">)</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;cmap&quot;</span><span class="p">,</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;vmin&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">im_ref</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">))</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;vmax&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">im_ref</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;ax&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;fig&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">extent</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;extent&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">extent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;pseudoTime [points]&quot;</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;pseudoFrequency [points]&quot;</span>
        
    <span class="k">if</span> <span class="p">(</span><span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">plot2d</span><span class="p">(</span>
                        <span class="n">im_ref</span><span class="p">,</span>
                        <span class="n">extent</span>  <span class="o">=</span> <span class="n">extent</span><span class="p">,</span>
                        <span class="n">now</span>     <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">title</span>   <span class="o">=</span> <span class="n">title</span><span class="p">,</span>
                        <span class="n">ylabel</span>  <span class="o">=</span> <span class="n">ylabel</span><span class="p">,</span>
                        <span class="n">xlabel</span>  <span class="o">=</span> <span class="n">xlabel</span><span class="p">,</span>
                        <span class="n">vmin</span>    <span class="o">=</span> <span class="n">vmin</span><span class="p">,</span>
                        <span class="n">vmax</span>    <span class="o">=</span> <span class="n">vmax</span><span class="p">,</span>
                        <span class="n">cmap</span>    <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span>
                        <span class="o">**</span><span class="n">kwargs</span>
                        <span class="p">)</span>

    <span class="c1"># Convert pixels into time and frequency values</span>
    <span class="n">y_len</span><span class="p">,</span> <span class="n">x_len</span> <span class="o">=</span> <span class="n">im_ref</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
    <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
    <span class="n">x_scaling</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">x_len</span>
    <span class="n">y_scaling</span> <span class="o">=</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">/</span> <span class="n">y_len</span>

    <span class="c1"># test if rois has a label column</span>
    <span class="k">if</span> <span class="s2">&quot;label&quot;</span> <span class="ow">in</span> <span class="n">rois</span><span class="p">:</span>
        <span class="c1"># select the label column</span>
        <span class="n">rois_label</span> <span class="o">=</span> <span class="n">rois</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">values</span>
        <span class="n">uniqueLabels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rois_label</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">uniqueLabels</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># if only one label or no label in rois</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">uniqueLabels</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rois</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;min_y&quot;</span><span class="p">]</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;min_x&quot;</span><span class="p">]</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;max_y&quot;</span><span class="p">]</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;max_x&quot;</span><span class="p">]</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                <span class="p">(</span><span class="n">x0</span> <span class="o">*</span> <span class="n">x_scaling</span> <span class="o">+</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">y0</span> <span class="o">*</span> <span class="n">y_scaling</span> <span class="o">+</span> <span class="n">ymin</span><span class="p">),</span>
                <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">*</span> <span class="n">x_scaling</span><span class="p">,</span>
                <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span> <span class="o">*</span> <span class="n">y_scaling</span><span class="p">,</span>
                <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># draw the rectangle</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Colormap</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">rand_cmap</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uniqueLabels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">first_color_black</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">cc</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rois</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">cc</span> <span class="o">=</span> <span class="n">cc</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;min_y&quot;</span><span class="p">]</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;min_x&quot;</span><span class="p">]</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;max_y&quot;</span><span class="p">]</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;max_x&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">uniqueLabels</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                    <span class="n">ii</span> <span class="o">=</span> <span class="n">index</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                <span class="p">(</span><span class="n">x0</span> <span class="o">*</span> <span class="n">x_scaling</span> <span class="o">+</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">y0</span> <span class="o">*</span> <span class="n">y_scaling</span> <span class="o">+</span> <span class="n">ymin</span><span class="p">),</span>
                <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">*</span> <span class="n">x_scaling</span><span class="p">,</span>
                <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span> <span class="o">*</span> <span class="n">y_scaling</span><span class="p">,</span>
                <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">edgecolor</span><span class="o">=</span><span class="n">color</span><span class="p">(</span><span class="n">ii</span><span class="p">),</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># draw the rectangle</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="c1"># SAVE FIGURE</span>
    <span class="k">if</span> <span class="n">savefig</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dpi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;dpi&quot;</span><span class="p">,</span> <span class="mi">96</span><span class="p">)</span>
        <span class="nb">format</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;format&quot;</span><span class="p">,</span> <span class="s2">&quot;png&quot;</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">,</span> <span class="s2">&quot;_spectro_overlayrois&quot;</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">savefig</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nb">format</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ax</span><span class="p">,</span> <span class="n">fig</span></div>


<span class="c1">#%%</span>
<div class="viewcode-block" id="plot1d"><a class="viewcode-back" href="../../_autosummary/util.visualization.plot1D.html#util.plot1d">[docs]</a><span class="k">def</span> <span class="nf">plot1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the waveform or spectrum of an audio signal. </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : 1d ndarray of integer</span>
<span class="sd">        Vector containing the abscissa values (horizontal axis)</span>
<span class="sd">             </span>
<span class="sd">    y : 1d ndarray of scalar</span>
<span class="sd">        Vector containing the ordinate values (vertical axis)  </span>
<span class="sd">    </span>
<span class="sd">    ax : axis, optional, default is None</span>
<span class="sd">        Draw the signal on this specific axis. Allow multiple plots on the same</span>
<span class="sd">        axis.</span>
<span class="sd">            </span>
<span class="sd">    \*\*kwargs, optional</span>
<span class="sd">        - figsize : tuple of integers, optional, default: (4,10)</span>
<span class="sd">            width, height in inches.  </span>
<span class="sd">        - facecolor : matplotlib color, optional, default: &#39;w&#39; (white)</span>
<span class="sd">            the background color.  </span>
<span class="sd">        - edgecolor : matplotlib color, optional, default: &#39;k&#39; (black)</span>
<span class="sd">            the border color. </span>
<span class="sd">        - color : matplotlib color, optional, default: &#39;k&#39; (black)</span>
<span class="sd">            the line color</span>
<span class="sd">            The following color abbreviations are supported:</span>
<span class="sd">            ==========  ========</span>
<span class="sd">            character   color</span>
<span class="sd">            ==========  ========</span>
<span class="sd">            &#39;b&#39;         blue</span>
<span class="sd">            &#39;g&#39;         green</span>
<span class="sd">            &#39;r&#39;         red</span>
<span class="sd">            &#39;c&#39;         cyan</span>
<span class="sd">            &#39;m&#39;         magenta</span>
<span class="sd">            &#39;y&#39;         yellow</span>
<span class="sd">            &#39;k&#39;         black</span>
<span class="sd">            &#39;w&#39;         white</span>
<span class="sd">            ==========  ========</span>
<span class="sd">            In addition, you can specify colors in many ways, including RGB </span>
<span class="sd">            tuples (0.2,1,0.5). See matplotlib color</span>
<span class="sd">        - linewidth : scalar, optional, default: 0.5</span>
<span class="sd">            width in pixels</span>
<span class="sd">        - figtitle: string, optional, default: &#39;Audiogram&#39;</span>
<span class="sd">            Title of the plot </span>
<span class="sd">        - xlabel : string, optional, default : &#39;Time [s]&#39;</span>
<span class="sd">            label of the horizontal axis</span>
<span class="sd">        - ylabel : string, optional, default : &#39;Amplitude [AU]&#39;</span>
<span class="sd">            label of the vertical axis</span>
<span class="sd">        - legend : string, optional, default : None</span>
<span class="sd">            Legend for the plot</span>
<span class="sd">        - now : boolean, optional, default : True</span>
<span class="sd">            if True, display now. Cannot display multiple plots. </span>
<span class="sd">            To display mutliple plots, set now=False until the last call for </span>
<span class="sd">            the last plot         </span>
<span class="sd">        </span>
<span class="sd">        ...and more, see matplotlib</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : Figure</span>
<span class="sd">        The Figure instance </span>
<span class="sd">    ax : Axis</span>
<span class="sd">        The Axis instance</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np    </span>
<span class="sd">    &gt;&gt;&gt; s, fs = maad.sound.load(&#39;../data/cold_forest_daylight.wav&#39;) </span>
<span class="sd">    </span>
<span class="sd">    Plot the audiogram</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; tn = np.arange(0,len(s))/fs</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = maad.util.plot1d(tn,s)</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; Sxx_power,tn,fn,_ = maad.sound.spectrogram(s,fs)</span>
<span class="sd">    </span>
<span class="sd">    Convert spectrogram into dB SPL</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; Lxx = maad.spl.power2dBSPL(Sxx_power, gain=42) </span>
<span class="sd">       </span>
<span class="sd">    Plot the spectrum at t = 7s</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; index = maad.util.nearest_idx(tn,7)</span>
<span class="sd">    &gt;&gt;&gt; fig_kwargs = {&#39;figtitle&#39;:&#39;Spectrum (PSD)&#39;,</span>
<span class="sd">                      &#39;xlabel&#39;:&#39;Frequency [Hz]&#39;,</span>
<span class="sd">                      &#39;ylabel&#39;:&#39;Power [dB]&#39;,</span>
<span class="sd">                      &#39;linewidth&#39;: 0.5</span>
<span class="sd">                      }</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; fig, ax = maad.util.plot1d(fn, Lxx[:,index], **fig_kwargs)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">figsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;figsize&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">facecolor</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;facecolor&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
    <span class="n">edgecolor</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;edgecolor&quot;</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">linewidth</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;linewidth&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;figtitle&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;xlabel&quot;</span><span class="p">,</span> <span class="s2">&quot;Time [s]&quot;</span><span class="p">)</span>
    <span class="n">ylabel</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;ylabel&quot;</span><span class="p">,</span> <span class="s2">&quot;Amplitude [AU]&quot;</span><span class="p">)</span>
    <span class="n">legend</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;legend&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;now&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="c1"># if no ax, create a figure and a subplot associated a figure otherwise</span>
    <span class="c1"># find the figure that belongs to ax</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="c1"># set the paramters of the figure</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_figheight</span><span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_figwidth</span><span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">facecolor</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">edgecolor</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>

    <span class="c1"># plot the data on the subplot</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># set legend to the line</span>
    <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">legend</span><span class="p">)</span>

    <span class="c1"># set the parameters of the subplot</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="c1">#ax.axis(&quot;tight&quot;)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">legend</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="c1"># Display the figure now</span>
    <span class="k">if</span> <span class="n">now</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">ax</span><span class="p">,</span> <span class="n">fig</span></div>


<span class="c1">#%%</span>
<div class="viewcode-block" id="plot_wave"><a class="viewcode-back" href="../../_autosummary/util.visualization.plot_wave.html#util.plot_wave">[docs]</a><span class="k">def</span> <span class="nf">plot_wave</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">tlims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot audio waveform.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s : 1d ndarray</span>
<span class="sd">        Audio signal.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Sampling rate of audio signal.</span>
<span class="sd">    tlims : tuple, optional</span>
<span class="sd">        Minimum and maximum temporal limits for the display (min_t, max_t). </span>
<span class="sd">        The default is None.</span>
<span class="sd">    ax : matplotlib.axes, optional</span>
<span class="sd">        Pre-existing axes for the plot. The default is None.</span>
<span class="sd">    **kwargs : matplotlib figure properties</span>
<span class="sd">        Other keyword arguments that are passed down to matplotlib.axes.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ax : matplotlib.axes</span>
<span class="sd">        The matplotlib axes associated to plot.</span>
<span class="sd">    </span>
<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    maad.sound.plot_spectrum</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    </span>
<span class="sd">    Plot a waveform of an audio signal.</span>
<span class="sd">    &gt;&gt;&gt; from maad import sound</span>
<span class="sd">    &gt;&gt;&gt; from maad.util import plot_wave</span>
<span class="sd">    &gt;&gt;&gt; s, fs = sound.load(&#39;../data/spinetail.wav&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax = plot_wave(s, fs)</span>
<span class="sd">    </span>
<span class="sd">    Use `plot_wave` with predifined matplotlib axes.</span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; s, fs = sound.load(&#39;../data/spinetail.wav&#39;)</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(2,1)</span>
<span class="sd">    &gt;&gt;&gt; plot_wave(s, fs, ax=ax[0], xlabel=&#39;&#39;, figtitle=&#39;Spinetail&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plot_wave(s, fs, tlims=(5,8), ax=ax[1])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">tlims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">tlims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">tlims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">fs</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">tlims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># add minimum value</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">fs</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">ax</span><span class="p">,</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">plot1d</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ax</span></div>


<span class="c1">#%%</span>
<div class="viewcode-block" id="plot_spectrum"><a class="viewcode-back" href="../../_autosummary/util.visualization.plot_spectrum.html#util.plot_spectrum">[docs]</a><span class="k">def</span> <span class="nf">plot_spectrum</span><span class="p">(</span><span class="n">pxx</span><span class="p">,</span> <span class="n">f_idx</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log_scale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot power spectral density estimate (PSD).</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pxx : 1d ndarray</span>
<span class="sd">        Power spectral density estimate computed with `maad.sound.spectrum`.</span>
<span class="sd">        </span>
<span class="sd">    f_idx : 1d ndarray</span>
<span class="sd">        Index of frequencies associated with the PSD.</span>
<span class="sd">    </span>
<span class="sd">    ax : matplotlib.axes, optional</span>
<span class="sd">        Pre-existing axes for the plot. The default is None.</span>
<span class="sd">        </span>
<span class="sd">    flims : tuple, optional</span>
<span class="sd">        Minimum and maximum spectral limits for the display (min_f, max_f). </span>
<span class="sd">        Default is None.</span>

<span class="sd">    log_scale : bool, optional</span>
<span class="sd">        Use a logarithmic scale to display amplitude values. The default is False.</span>
<span class="sd">    </span>
<span class="sd">    fill : bool, optional</span>
<span class="sd">        Fill the area between the curve and the minimum value.</span>
<span class="sd">        </span>
<span class="sd">    **kwargs : matplotlib figure properties</span>
<span class="sd">            Other keyword arguments that are passed down to matplotlib.axes.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ax : matplotlib.axes</span>
<span class="sd">        The matplotlib axes associated to plot.</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    maad.sound.spectrum, maad.util.plot_wave</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    </span>
<span class="sd">    Plot a spectrum of an audio signal.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from maad import sound, util</span>
<span class="sd">    &gt;&gt;&gt; s, fs = sound.load(&#39;../data/spinetail.wav&#39;)</span>
<span class="sd">    &gt;&gt;&gt; pxx, f_idx = sound.spectrum(s, fs, nperseg=1024)</span>
<span class="sd">    &gt;&gt;&gt; util.plot_spectrum(pxx, f_idx)</span>
<span class="sd">    </span>
<span class="sd">    Use `plot_spectrum` with predifined matplotlib axes.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; s, fs = sound.load(&#39;../data/spinetail.wav&#39;)</span>
<span class="sd">    &gt;&gt;&gt; s_slice = sound.trim(s, fs, 5, 8)</span>
<span class="sd">    &gt;&gt;&gt; pxx, f_idx = sound.spectrum(s_slice, fs, nperseg=1024)</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(2,1, figsize=(10,6))</span>
<span class="sd">    &gt;&gt;&gt; util.plot_wave(s_slice, fs, ax=ax[0])</span>
<span class="sd">    &gt;&gt;&gt; util.plot_spectrum(pxx, f_idx, ax=ax[1], log_scale=True)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ylabel</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;ylabel&quot;</span><span class="p">,</span> <span class="s2">&quot;Amplitude [AU]&quot;</span><span class="p">)</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;xlabel&quot;</span><span class="p">,</span> <span class="s2">&quot;Frequency [Hz]&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">log_scale</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">pxx</span> <span class="o">=</span> <span class="n">power2dB</span><span class="p">(</span><span class="n">pxx</span><span class="p">)</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;Amplitude [dB]&#39;</span>

    <span class="k">if</span> <span class="n">flims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pxx</span> <span class="o">=</span> <span class="n">pxx</span><span class="p">[(</span><span class="n">f_idx</span> <span class="o">&gt;=</span> <span class="n">flims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">f_idx</span> <span class="o">&lt;=</span> <span class="n">flims</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
        <span class="n">f_idx</span> <span class="o">=</span> <span class="n">f_idx</span><span class="p">[(</span><span class="n">f_idx</span> <span class="o">&gt;=</span> <span class="n">flims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">f_idx</span> <span class="o">&lt;=</span> <span class="n">flims</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

    <span class="n">amp_min</span> <span class="o">=</span> <span class="n">pxx</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">ax</span><span class="p">,</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">plot1d</span><span class="p">(</span><span class="n">f_idx</span><span class="p">,</span> <span class="n">pxx</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fill</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">f_idx</span><span class="p">,</span> <span class="n">amp_min</span><span class="p">,</span> <span class="n">pxx</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ax</span></div>


<span class="c1">#%%</span>
<div class="viewcode-block" id="plot2d"><a class="viewcode-back" href="../../_autosummary/util.visualization.plot2D.html#util.plot2d">[docs]</a><span class="k">def</span> <span class="nf">plot2d</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Display the spectrogram of an audio signal. </span>
<span class="sd">    </span>
<span class="sd">    The spectrogram should be previously computed using the function </span>
<span class="sd">    ``maad.sound.spectrogram``.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    im : 2D numpy array </span>
<span class="sd">        Image or Spectrogram</span>
<span class="sd">             </span>
<span class="sd">    ax : axis, optional, default is None</span>
<span class="sd">        Draw the image on this specific axis. Allow multiple plots on the same</span>
<span class="sd">        figure.</span>
<span class="sd">            </span>
<span class="sd">    \*\*kwargs, optional</span>
<span class="sd">        - figsize : tuple of integers, optional, default: (4,13)</span>
<span class="sd">            width, height in inches.  </span>
<span class="sd">        - title : string, optional, default : &#39;Spectrogram&#39;</span>
<span class="sd">            title of the figure</span>
<span class="sd">        - xlabel : string, optional, default : &#39;Time [s]&#39;</span>
<span class="sd">            label of the horizontal axis</span>
<span class="sd">        - ylabel : string, optional, default : &#39;Frequency [Hz]&#39;</span>
<span class="sd">            label of the vertical axis</span>
<span class="sd">        - xticks : tuple of ndarrays, optional, default : none</span>
<span class="sd">            * ticks : array_like =&gt; A list of positions at which ticks should </span>
<span class="sd">            be placed. You can pass an empty list to disable yticks.</span>
<span class="sd">            * labels : array_like, optional =&gt;  A list of explicit labels to place </span>
<span class="sd">            at the given locs.</span>
<span class="sd">        - yticks : tuple of ndarrays, optional, default : none</span>
<span class="sd">            * ticks : array_like =&gt; A list of positions at which ticks should </span>
<span class="sd">            be placed. You can pass an empty list to disable yticks.</span>
<span class="sd">            * labels : array_like, optional =&gt;  A list of explicit labels to place </span>
<span class="sd">            at the given locs.</span>
<span class="sd">        - cmap : string or Colormap object, optional, default is &#39;gray&#39;</span>
<span class="sd">            See https://matplotlib.org/examples/color/colormaps_reference.html</span>
<span class="sd">            in order to get all the  existing colormaps</span>
<span class="sd">            examples: &#39;hsv&#39;, &#39;hot&#39;, &#39;bone&#39;, &#39;tab20c&#39;, &#39;jet&#39;, &#39;seismic&#39;, </span>
<span class="sd">            &#39;viridis&#39;...</span>
<span class="sd">        - vmin, vmax : scalar, optional, default: None</span>
<span class="sd">            `vmin` and `vmax` are used in conjunction with norm to normalize</span>
<span class="sd">            luminance data.  Note if you pass a `norm` instance, your</span>
<span class="sd">            settings for `vmin` and `vmax` will be ignored.</span>
<span class="sd">        - extent : list of scalars [left, right, bottom, top], optional, default: None</span>
<span class="sd">            The location, in data-coordinates, of the lower-left and</span>
<span class="sd">            upper-right corners. If `None`, the image is positioned such that</span>
<span class="sd">            the pixel centers fall on zero-based (row, column) indices.</span>
<span class="sd">        - now : boolean, optional, default : True</span>
<span class="sd">            if True, display now. Cannot display multiple images. </span>
<span class="sd">            To display mutliple images, set now=False until the last call for </span>
<span class="sd">            the last image    </span>
<span class="sd">        - interpolation : list of string [None, &#39;none&#39;, &#39;nearest&#39;, &#39;bilinear&#39;, </span>
<span class="sd">           &#39;bicubic&#39;, &#39;spline16&#39;,&#39;spline36&#39;, &#39;hanning&#39;, &#39;hamming&#39;, &#39;hermite&#39;, </span>
<span class="sd">           &#39;kaiser&#39;, &#39;quadric&#39;,&#39;catrom&#39;, &#39;gaussian&#39;, &#39;bessel&#39;, &#39;mitchell&#39;, </span>
<span class="sd">           &#39;sinc&#39;, &#39;lanczos&#39;], optional, default : None</span>
<span class="sd">            </span>
<span class="sd">        ... and more, see matplotlib</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : Figure</span>
<span class="sd">        The Figure instance </span>
<span class="sd">    ax : Axis</span>
<span class="sd">        The Axis instance</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; w, fs = maad.sound.load(&#39;../data/cold_forest_daylight.wav&#39;) </span>
<span class="sd">    &gt;&gt;&gt; Sxx_power,tn,fn,_ = maad.sound.spectrogram(w,fs)</span>
<span class="sd">    &gt;&gt;&gt; Lxx = maad.spl.power2dBSPL(Sxx_power, gain=42) # convert into dB SPL</span>
<span class="sd">    &gt;&gt;&gt; fig_kwargs = {&#39;vmax&#39;: Lxx.max(),</span>
<span class="sd">                      &#39;vmin&#39;:0,</span>
<span class="sd">                      &#39;extent&#39;:(tn[0], tn[-1], fn[0], fn[-1]),</span>
<span class="sd">                      &#39;title&#39;:&#39;Power spectrogram density (PSD) in dB SPL&#39;,</span>
<span class="sd">                      &#39;xlabel&#39;:&#39;Time [s]&#39;,</span>
<span class="sd">                      &#39;ylabel&#39;:&#39;Frequency [Hz]&#39;,</span>
<span class="sd">                      }</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = maad.util.plot2d(Lxx,interpolation=None,**fig_kwargs)      </span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># matplotlib parameters</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">ylabel</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;ylabel&quot;</span><span class="p">,</span> <span class="s2">&quot;Frequency [Hz]&quot;</span><span class="p">)</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;xlabel&quot;</span><span class="p">,</span> <span class="s2">&quot;Time [s]&quot;</span><span class="p">)</span>
    <span class="n">xticks</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;xticks&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">yticks</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;yticks&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;cmap&quot;</span><span class="p">,</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;vmin&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;vmax&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">extent</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;extent&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;now&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">extent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">figsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
            <span class="s2">&quot;figsize&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="mf">0.20</span> <span class="o">*</span> <span class="p">(</span><span class="n">extent</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="mf">0.33</span> <span class="o">*</span> <span class="p">(</span><span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">figsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;figsize&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span>

    <span class="c1"># if no ax, create a figure and a subplot associated a figure otherwise</span>
    <span class="c1"># find the figure that belongs to ax</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="c1"># set the paramters of the figure</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_figheight</span><span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_figwidth</span><span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>

    <span class="c1"># display image</span>
    <span class="n">_im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> 
                    <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">colorbar</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">_im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

    <span class="c1"># set the parameters of the subplot</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xticks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">xticks</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">yticks</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="c1"># Display the figure now</span>
    <span class="k">if</span> <span class="n">now</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">ax</span><span class="p">,</span> <span class="n">fig</span></div>

<span class="c1">#%%</span>
<div class="viewcode-block" id="plot_spectrogram"><a class="viewcode-back" href="../../_autosummary/util.visualization.plot_spectrogram.html#util.plot_spectrogram">[docs]</a><span class="k">def</span> <span class="nf">plot_spectrogram</span><span class="p">(</span><span class="n">Sxx</span><span class="p">,</span> <span class="n">extent</span><span class="p">,</span> <span class="n">db_range</span><span class="o">=</span><span class="mi">96</span><span class="p">,</span> <span class="n">gain</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">log_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot spectrogram represenation.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Sxx : 2d ndarray</span>
<span class="sd">        Spectrogram computed using `maad.sound.spectrogram`.</span>
<span class="sd">    extent : list of scalars [left, right, bottom, top]</span>
<span class="sd">        Location, in data-coordinates, of the lower-left and upper-right corners.</span>
<span class="sd">    db_range : int or float, optional</span>
<span class="sd">        Range of values to display the spectrogram. The default is 96.</span>
<span class="sd">    gain : int or float, optional</span>
<span class="sd">        Gain in decibels added to the signal for display. The default is 0.</span>
<span class="sd">    log_scale : bool, optional</span>
<span class="sd">        Logarithmic transformation of spectrogram coefficients to enhace visual </span>
<span class="sd">        representation. The default is True.</span>
<span class="sd">    colorbar : bool, optional</span>
<span class="sd">        Plot the colorbar next to the spectrogram. The default is True.</span>
<span class="sd">    interpolation : bool, optional</span>
<span class="sd">        Interpolate spectrogram values to enhance visual representation. </span>
<span class="sd">        The default is &#39;bilinear&#39;.</span>
<span class="sd">    **kwargs : matplotlib figure properties</span>
<span class="sd">            Other keyword arguments that are passed down to matplotlib.axes.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ax : matplotlib.axes</span>
<span class="sd">        The matplotlib axes associated to plot.</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    maad.sound.plot_spectrum, maad.util.plot_wave</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    </span>
<span class="sd">    Plot the spectrogram of an audio.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from maad import sound, util</span>
<span class="sd">    &gt;&gt;&gt; s, fs = sound.load(&#39;../data/spinetail.wav&#39;) </span>
<span class="sd">    &gt;&gt;&gt; Sxx, tn, fn, ext = sound.spectrogram(s,fs)</span>
<span class="sd">    &gt;&gt;&gt; util.plot_spectrogram(Sxx, ext, db_range=50, gain=30, figsize=(4,10))</span>
<span class="sd">        </span>
<span class="sd">    Use `plot_spectrogram` with predifined matplotlib axes.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(2,1, figsize=(10,6))</span>
<span class="sd">    &gt;&gt;&gt; util.plot_wave(s, fs, ax=ax[0])</span>
<span class="sd">    &gt;&gt;&gt; util.plot_spectrogram(Sxx, ext, db_range=50, gain=30, colorbar=False, ax=ax[1])</span>

<span class="sd">    Plot a single frase of the spinetail.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; Sxx, tn, fn, ext = sound.spectrogram(s,fs, flims=(2000,15000), tlims=(5,8))</span>
<span class="sd">    &gt;&gt;&gt; util.plot_spectrogram(Sxx, ext, db_range=50, gain=30, figsize=(4,6))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">log_scale</span><span class="p">:</span>
        <span class="n">Sxx_db</span> <span class="o">=</span> <span class="n">power2dB</span><span class="p">(</span><span class="n">Sxx</span><span class="p">,</span> <span class="n">db_range</span><span class="p">,</span> <span class="n">gain</span><span class="p">)</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">Sxx_db</span> <span class="o">=</span> <span class="n">Sxx</span>
    
    <span class="n">ax</span><span class="p">,</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">plot2d</span><span class="p">(</span><span class="n">Sxx_db</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="n">colorbar</span><span class="p">,</span> 
                     <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span></div>

<span class="c1">#%%</span>
<div class="viewcode-block" id="rand_cmap"><a class="viewcode-back" href="../../_autosummary/util.visualization.rand_cmap.html#util.rand_cmap">[docs]</a><span class="k">def</span> <span class="nf">rand_cmap</span><span class="p">(</span>
    <span class="n">nlabels</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;bright&quot;</span><span class="p">,</span>
    <span class="n">first_color_black</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">last_color_black</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a random colormap to be used together with matplotlib. Useful for segmentation tasks</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nlabels : Integer</span>
<span class="sd">        Number of labels (size of colormap)</span>
<span class="sd">    type : String</span>
<span class="sd">        &#39;bright&#39; for strong colors, &#39;soft&#39; for pastel colors. Default is &#39;bright&#39;</span>
<span class="sd">    first_color_black : Boolean</span>
<span class="sd">        Option to use first color as black. Default is True  </span>
<span class="sd">    last_color_black : Boolean   </span>
<span class="sd">        Option to use last color as black, Default is False</span>
<span class="sd">    verbose  : Boolean   </span>
<span class="sd">        Prints the number of labels and shows the colormap. Default is False</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    random_colormap : Colormap </span>
<span class="sd">        Colormap type used by matplotlib</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    adapted from https://github.com/delestro/rand_cmap author : delestro    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># initialize the random seed in order to get always the same random order</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">321</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of labels: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nlabels</span><span class="p">))</span>

    <span class="c1"># Generate color map for bright colors, based on hsv</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;bright&quot;</span><span class="p">:</span>
        <span class="n">randHSVcolors</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlabels</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="c1"># Convert HSV list to RGB</span>
        <span class="n">randRGBcolors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">HSVcolor</span> <span class="ow">in</span> <span class="n">randHSVcolors</span><span class="p">:</span>
            <span class="n">randRGBcolors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">colorsys</span><span class="o">.</span><span class="n">hsv_to_rgb</span><span class="p">(</span><span class="n">HSVcolor</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">HSVcolor</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">HSVcolor</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="p">)</span>

    <span class="c1"># Generate soft pastel colors, by limiting the RGB spectrum</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;soft&quot;</span><span class="p">:</span>
        <span class="n">low</span> <span class="o">=</span> <span class="mf">0.6</span>
        <span class="n">high</span> <span class="o">=</span> <span class="mf">0.95</span>
        <span class="n">randRGBcolors</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">high</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">high</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">high</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlabels</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="k">if</span> <span class="n">first_color_black</span><span class="p">:</span>
        <span class="n">randRGBcolors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">last_color_black</span><span class="p">:</span>
        <span class="n">randRGBcolors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="n">random_colormap</span> <span class="o">=</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span>
        <span class="s2">&quot;new_map&quot;</span><span class="p">,</span> <span class="n">randRGBcolors</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">nlabels</span>
    <span class="p">)</span>

    <span class="c1"># Display colorbar</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colors</span><span class="p">,</span> <span class="n">colorbar</span>
        <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>

        <span class="n">bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nlabels</span><span class="p">,</span> <span class="n">nlabels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">nlabels</span><span class="p">)</span>

        <span class="n">colorbar</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">random_colormap</span><span class="p">,</span>
            <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
            <span class="n">spacing</span><span class="o">=</span><span class="s2">&quot;proportional&quot;</span><span class="p">,</span>
            <span class="n">ticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">boundaries</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%1i</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">orientation</span><span class="o">=</span><span class="sa">u</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">random_colormap</span></div>


<span class="c1">#%%</span>
<div class="viewcode-block" id="crop_image"><a class="viewcode-back" href="../../_autosummary/util.visualization.crop_image.html#util.crop_image">[docs]</a><span class="k">def</span> <span class="nf">crop_image</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">fcrop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tcrop</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Crop a spectrogram (or an image) in time (horizontal X axis) and frequency</span>
<span class="sd">    (vertical y axis)</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    im : 2d ndarray</span>
<span class="sd">        image to be cropped</span>
<span class="sd">    </span>
<span class="sd">    tn, fn : 1d ndarray</span>
<span class="sd">        tn is the time vector. fn is the frequency vector. They are required </span>
<span class="sd">        in order to know the correspondance between pixels and (time,frequency)</span>
<span class="sd">    </span>
<span class="sd">    fcrop, tcrop : list of 2 scalars [min, max], optional, default is None</span>
<span class="sd">        fcrop corresponds to the min and max boundary frequency values</span>
<span class="sd">        tcrop corresponds to the min and max boundary time values</span>
<span class="sd">                </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    im : 2d ndarray</span>
<span class="sd">        image cropped</span>
<span class="sd">        </span>
<span class="sd">    tn, fn, 1d ndarray</span>
<span class="sd">        new time and frequency vectors</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; w, fs = maad.sound.load(&#39;../data/cold_forest_daylight.wav&#39;) </span>
<span class="sd">    &gt;&gt;&gt; Sxx_power,tn,fn,_ = maad.sound.spectrogram(w,fs)</span>
<span class="sd">    &gt;&gt;&gt; Lxx = maad.spl.power2dBSPL(Sxx_power, gain=42) # convert into dB SPL</span>
<span class="sd">    &gt;&gt;&gt; fig_kwargs = {&#39;vmax&#39;: Lxx.max(),</span>
<span class="sd">                      &#39;vmin&#39;:0,</span>
<span class="sd">                      &#39;extent&#39;:(tn[0], tn[-1], fn[0], fn[-1]),</span>
<span class="sd">                      &#39;title&#39;:&#39;Power spectrogram density (PSD)&#39;,</span>
<span class="sd">                      &#39;xlabel&#39;:&#39;Time [s]&#39;,</span>
<span class="sd">                      &#39;ylabel&#39;:&#39;Frequency [Hz]&#39;,</span>
<span class="sd">                      }</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = maad.util.plot2d(Lxx,**fig_kwargs)      </span>
<span class="sd">    &gt;&gt;&gt; Lxx_crop, tn_crop, fn_crop = maad.util.crop_image(Lxx, tn, fn, fcrop=(2000,10000), tcrop=(0,30))</span>
<span class="sd">    &gt;&gt;&gt; fig_kwargs = {&#39;vmax&#39;: Lxx.max(),</span>
<span class="sd">                      &#39;vmin&#39;:0,</span>
<span class="sd">                      &#39;extent&#39;:(tn_crop[0], tn_crop[-1], fn_crop[0], fn_crop[-1]),</span>
<span class="sd">                      &#39;title&#39;:&#39;Crop of the power spectrogram density (PSD)&#39;,</span>
<span class="sd">                      &#39;xlabel&#39;:&#39;Time [s]&#39;,</span>
<span class="sd">                      &#39;ylabel&#39;:&#39;Frequency [Hz]&#39;,</span>
<span class="sd">                      }</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = maad.util.plot2d(Lxx_crop,**fig_kwargs)  </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">tcrop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">indt</span> <span class="o">=</span> <span class="p">(</span><span class="n">tn</span> <span class="o">&gt;=</span> <span class="n">tcrop</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">tn</span> <span class="o">&lt;=</span> <span class="n">tcrop</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">im</span><span class="p">[:,</span> <span class="n">indt</span><span class="p">]</span>
        <span class="c1"># redefine tn</span>
        <span class="n">tn</span> <span class="o">=</span> <span class="n">tn</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">indt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">fcrop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">indf</span> <span class="o">=</span> <span class="p">(</span><span class="n">fn</span> <span class="o">&gt;=</span> <span class="n">fcrop</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">fn</span> <span class="o">&lt;=</span> <span class="n">fcrop</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">im</span><span class="p">[</span>
            <span class="n">indf</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="c1"># redefine fn</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">indf</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">im</span><span class="p">,</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fn</span></div>


<span class="c1"># =============================================================================</span>
<div class="viewcode-block" id="save_figlist"><a class="viewcode-back" href="../../_autosummary/util.visualization.save_figlist.html#util.save_figlist">[docs]</a><span class="k">def</span> <span class="nf">save_figlist</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">figlist</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save a list of figures or spectrograms to disk.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fname: string</span>
<span class="sd">        Suffix string add to the filename. The extension should be specified since it </span>
<span class="sd">        indicates the image format.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function does not return any variable.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fig</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">figlist</span><span class="p">):</span>
        <span class="n">fname_save</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
        <span class="n">imsave</span><span class="p">(</span><span class="n">fname_save</span><span class="p">,</span> <span class="n">fig</span><span class="p">)</span></div>


<span class="c1"># =============================================================================</span>
<div class="viewcode-block" id="plot_features_map"><a class="viewcode-back" href="../../_autosummary/util.visualization.plot_features_map.html#util.plot_features_map">[docs]</a><span class="k">def</span> <span class="nf">plot_features_map</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;24h&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot features values on a heatmap.</span>
<span class="sd">    </span>
<span class="sd">    The plot has the features the vertical axis and the time on the horizontal axis.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : Panda DataFrame</span>
<span class="sd">        DataFrame with features (ie. indices).</span>
<span class="sd">    </span>
<span class="sd">    norm : boolean, default is True</span>
<span class="sd">        if True, the features are scaled between 0 to 1</span>
<span class="sd">        </span>
<span class="sd">    mode : string in {&#39;24h&#39;}, default is &#39;24h&#39;</span>
<span class="sd">        Select if the timeline of the phenology :</span>
<span class="sd">            -&#39;24h&#39; : average of the results over a day</span>
<span class="sd">            - otherwise, the timeline is the timeline of the dataframe</span>
<span class="sd">            </span>
<span class="sd">    **kwargs</span>
<span class="sd">        Specific to this function:</span>
<span class="sd">        </span>
<span class="sd">        - ftime : Time format to display as x label by default &#39;%Y-%m-%d&#39;(see https://docs.python.org/fr/3.6/library/datetime.html?highlight=strftime#strftime-strptime-behavior)</span>
<span class="sd">            </span>
<span class="sd">        Specific to matplotlib:</span>
<span class="sd">            </span>
<span class="sd">        - figsize : tuple of integers, optional, default: (4,10) width, height in inches.  </span>
<span class="sd">        </span>
<span class="sd">        - title : string, optional, default : &#39;Spectrogram&#39; title of the figure</span>
<span class="sd">        </span>
<span class="sd">        - xlabel : string, optional, default : &#39;Time [s]&#39; label of the horizontal axis</span>

<span class="sd">        - ylabel : string, optional, default : &#39;Amplitude [AU]&#39; label of the vertical axis</span>
<span class="sd">            </span>
<span class="sd">        - xticks : tuple of ndarrays, optional, default : none</span>
<span class="sd">            * ticks : array_like =&gt; A list of positions at which ticks should </span>
<span class="sd">            be placed. You can pass an empty list to disable yticks.</span>
<span class="sd">            * labels : array_like, optional =&gt;  A list of explicit labels to place </span>
<span class="sd">            at the given locs.</span>
<span class="sd">            </span>
<span class="sd">        - yticks : tuple of ndarrays, optional, default : none</span>
<span class="sd">            * ticks : array_like =&gt; A list of positions at which ticks should </span>
<span class="sd">            be placed. You can pass an empty list to disable yticks.</span>
<span class="sd">            * labels : array_like, optional =&gt;  A list of explicit labels to place </span>
<span class="sd">            at the given locs.</span>
<span class="sd">        </span>
<span class="sd">        - cmap : string or Colormap object, optional, default is &#39;gray&#39;</span>
<span class="sd">            See https://matplotlib.org/examples/color/colormaps_reference.html</span>
<span class="sd">            in order to get all the  existing colormaps</span>
<span class="sd">            examples: &#39;hsv&#39;, &#39;hot&#39;, &#39;bone&#39;, &#39;tab20c&#39;, &#39;jet&#39;, &#39;seismic&#39;, </span>
<span class="sd">            &#39;viridis&#39;...</span>
<span class="sd">        </span>
<span class="sd">        - vmin, vmax : scalar, optional, default: None</span>
<span class="sd">            `vmin` and `vmax` are used in conjunction with norm to normalize</span>
<span class="sd">            luminance data.  Note if you pass a `norm` instance, your</span>
<span class="sd">            settings for `vmin` and `vmax` will be ignored.</span>
<span class="sd">        </span>
<span class="sd">        - extent : list of scalars [left, right, bottom, top], optional, default: None</span>
<span class="sd">            The location, in data-coordinates, of the lower-left and</span>
<span class="sd">            upper-right corners. If `None`, the image is positioned such that</span>
<span class="sd">            the pixel centers fall on zero-based (row, column) indices.</span>
<span class="sd">        </span>
<span class="sd">        - now : boolean, optional, default : True</span>
<span class="sd">            if True, display now. Cannot display multiple images. </span>
<span class="sd">            To display mutliple images, set now=False until the last call for </span>
<span class="sd">            the last image      </span>
<span class="sd">            </span>
<span class="sd">        ... and more, see matplotlib</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : Figure</span>
<span class="sd">        The Figure instance </span>
<span class="sd">    ax : Axis</span>
<span class="sd">        The Axis instance   </span>
<span class="sd">       </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    see plot_extract_alpha_indices.py advanced example for a complete example</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; np.random.seed(2021)</span>
<span class="sd">    &gt;&gt;&gt; M = np.random.rand(24, 7)</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame(M)</span>
<span class="sd">    &gt;&gt;&gt; indices = [&#39;A&#39;,&#39;B&#39;,&#39;C&#39;,&#39;D&#39;,&#39;E&#39;,&#39;F&#39;,&#39;G&#39;]</span>
<span class="sd">    &gt;&gt;&gt; df.columns = indices</span>
<span class="sd">    &gt;&gt;&gt; df.index =pd.date_range(start=pd.Timestamp(&#39;00:00:00&#39;), end=pd.Timestamp(&#39;23:00:00&#39;), freq=&#39;1H&#39;)</span>
<span class="sd">    &gt;&gt;&gt; maad.util.plot_features_map(df) </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;df must be a Pandas Dataframe&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;df must have an index of type DateTimeIndex&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;24h&quot;</span><span class="p">:</span>
        <span class="c1"># Mean values by hour</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="c1"># Get the list of unique index of type &#39;hour&#39;</span>
        <span class="n">x_label</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;h&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Get the list of unique index of type &#39;hour&#39;</span>
        <span class="n">ftime</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;ftime&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">x_value</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">ftime</span><span class="p">)</span>
        <span class="n">x_label</span> <span class="o">=</span> <span class="n">x_value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">norm</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">linear_scale</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="c1"># kwargs</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;cmap&quot;</span><span class="p">,</span> <span class="s2">&quot;RdBu_r&quot;</span><span class="p">)</span>

    <span class="c1"># plot</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">caxes</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">caxes</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Normalized value&quot;</span><span class="p">)</span>
    <span class="c1"># Set ticks on both sides of axes on</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labeltop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># We want to show all ticks...</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_label</span><span class="p">)))</span>
    <span class="c1"># ... and label them with the respective list entries</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
    <span class="c1"># Rotate the tick labels and set their alignment.</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<span class="c1"># =============================================================================</span>


<div class="viewcode-block" id="plot_features"><a class="viewcode-back" href="../../_autosummary/util.visualization.plot_features.html#util.plot_features">[docs]</a><span class="k">def</span> <span class="nf">plot_features</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;24h&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the variation of features values (ie. indices) in the DataFrame obtained </span>
<span class="sd">    with ``maad.features``.</span>
<span class="sd">            </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : Panda DataFrame</span>
<span class="sd">        DataFrame with features (ie. indices).</span>
<span class="sd">    </span>
<span class="sd">    norm : boolean, default is True</span>
<span class="sd">        if True, the features are normalized by the max</span>
<span class="sd">        </span>
<span class="sd">    mode : string in {&#39;24h&#39;}, default is &#39;24h&#39;</span>
<span class="sd">        Select if the timeline of the phenology :</span>
<span class="sd">            -&#39;24h&#39; : average of the results over a day</span>
<span class="sd">            - otherwise, the timeline is the timeline of the dataframe</span>
<span class="sd">            </span>
<span class="sd">    **kwargs</span>
<span class="sd">        - figsize : tuple of integers, optional, default: (4,10)</span>
<span class="sd">            width, height in inches.  </span>
<span class="sd">        </span>
<span class="sd">        - figtitle : string, optional, default : &#39;&#39;</span>
<span class="sd">            title of the figure</span>
<span class="sd">        </span>
<span class="sd">        - xlabel : string, optional, default : &#39;Time [s]&#39;</span>
<span class="sd">            label of the horizontal axis</span>
<span class="sd">        </span>
<span class="sd">        - ylabel : string, optional, default : &#39;Amplitude [AU]&#39;</span>
<span class="sd">            label of the vertical axis</span>
<span class="sd">            </span>
<span class="sd">        - xticks : tuple of ndarrays, optional, default : none</span>
<span class="sd">            * ticks : array_like =&gt; A list of positions at which ticks should </span>
<span class="sd">            be placed. You can pass an empty list to disable yticks.</span>
<span class="sd">            * labels : array_like, optional =&gt;  A list of explicit labels to place </span>
<span class="sd">            at the given locs.</span>
<span class="sd">            </span>
<span class="sd">        - yticks : tuple of ndarrays, optional, default : none</span>
<span class="sd">            * ticks : array_like =&gt; A list of positions at which ticks should </span>
<span class="sd">            be placed. You can pass an empty list to disable yticks.</span>
<span class="sd">            * labels : array_like, optional =&gt;  A list of explicit labels to place </span>
<span class="sd">            at the given locs.</span>

<span class="sd">        - now : boolean, optional, default : True</span>
<span class="sd">            if True, display now. Cannot display multiple images. </span>
<span class="sd">            To display mutliple images, set now=False until the last call for </span>
<span class="sd">            the last image      </span>
<span class="sd">            </span>
<span class="sd">        ... and more, see matplotlib</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : Figure</span>
<span class="sd">        The Figure instance </span>
<span class="sd">    ax : Axis</span>
<span class="sd">        The Axis instance</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    see plot_extract_alpha_indices.py advanced example for a complete example</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; np.random.seed(2021)</span>
<span class="sd">    &gt;&gt;&gt; M = np.random.rand(24, 2)</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame(M)</span>
<span class="sd">    &gt;&gt;&gt; indices = [&#39;A&#39;,&#39;B&#39;]</span>
<span class="sd">    &gt;&gt;&gt; df.columns = indices</span>
<span class="sd">    &gt;&gt;&gt; df.index =pd.date_range(start=pd.Timestamp(&#39;00:00:00&#39;), end=pd.Timestamp(&#39;23:00:00&#39;), freq=&#39;1H&#39;)</span>
<span class="sd">    &gt;&gt;&gt; maad.util.plot_features(df) </span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;df must be a Pandas Dataframe&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;df must have an index of type DateTimeIndex&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;24h&quot;</span><span class="p">:</span>
        <span class="c1"># Mean values by hour</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">norm</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">linear_scale</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="c1"># plot</span>
    <span class="kn">import</span> <span class="nn">itertools</span>
    <span class="kn">from</span> <span class="nn">matplotlib.lines</span> <span class="kn">import</span> <span class="n">Line2D</span>

    <span class="n">list_markers</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">Line2D</span><span class="o">.</span><span class="n">markers</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">markers</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">(</span><span class="n">list_markers</span><span class="p">)</span>
    <span class="n">prop_cycle</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;axes.prop_cycle&quot;</span><span class="p">]</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">(</span><span class="n">prop_cycle</span><span class="o">.</span><span class="n">by_key</span><span class="p">()[</span><span class="s2">&quot;color&quot;</span><span class="p">])</span>

    <span class="n">figsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;figsize&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># if no ax, create a figure and a subplot associated a figure otherwise</span>
    <span class="c1"># find the figure that belongs to ax</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">figsize</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">indice</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
            <span class="n">df</span><span class="p">[</span><span class="n">indice</span><span class="p">],</span>
            <span class="n">marker</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">markers</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">colors</span><span class="p">),</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">indice</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;24h&quot;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Day time (Hour)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<span class="c1"># =============================================================================</span>
<div class="viewcode-block" id="plot_correlation_map"><a class="viewcode-back" href="../../_autosummary/util.visualization.plot_correlation_map.html#util.plot_correlation_map">[docs]</a><span class="k">def</span> <span class="nf">plot_correlation_map</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">R_threshold</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;spearman&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the correlation map between indices in the DataFrame obtained</span>
<span class="sd">    with ``maad``.</span>
<span class="sd">        </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : Panda DataFrame</span>
<span class="sd">        DataFrame with features (ie. indices).</span>
<span class="sd">        </span>
<span class="sd">    R_threshold : scalar between 0 to 1, default is 0.75</span>
<span class="sd">        Show correlations with R higher than R_threshold</span>
<span class="sd">        </span>
<span class="sd">    method : string in {&#39;spearman&#39;, &#39;pearson&#39;}, default is &#39;spearman&#39;</span>
<span class="sd">        Choose the correlation type</span>
<span class="sd">    </span>
<span class="sd">    **kwargs</span>
<span class="sd">        - figsize : tuple of integers, optional, default: (4,10)</span>
<span class="sd">            width, height in inches.  </span>
<span class="sd">        </span>
<span class="sd">        - title : string, optional, default : &#39;Spectrogram&#39;</span>
<span class="sd">            title of the figure</span>
<span class="sd">        </span>
<span class="sd">        - xlabel : string, optional, default : &#39;Time [s]&#39;</span>
<span class="sd">            label of the horizontal axis</span>
<span class="sd">        </span>
<span class="sd">        - ylabel : string, optional, default : &#39;Amplitude [AU]&#39;</span>
<span class="sd">            label of the vertical axis</span>
<span class="sd">            </span>
<span class="sd">        - xticks : tuple of ndarrays, optional, default : none</span>
<span class="sd">            * ticks : array_like =&gt; A list of positions at which ticks should </span>
<span class="sd">            be placed. You can pass an empty list to disable yticks.</span>
<span class="sd">            * labels : array_like, optional =&gt;  A list of explicit labels to place </span>
<span class="sd">            at the given locs.</span>
<span class="sd">            </span>
<span class="sd">        - yticks : tuple of ndarrays, optional, default : none</span>
<span class="sd">            * ticks : array_like =&gt; A list of positions at which ticks should </span>
<span class="sd">            be placed. You can pass an empty list to disable yticks.</span>
<span class="sd">            * labels : array_like, optional =&gt;  A list of explicit labels to place </span>
<span class="sd">            at the given locs.</span>
<span class="sd">        </span>
<span class="sd">        - cmap : string or Colormap object, optional, default is &#39;gray&#39;</span>
<span class="sd">            See https://matplotlib.org/examples/color/colormaps_reference.html</span>
<span class="sd">            in order to get all the  existing colormaps</span>
<span class="sd">            examples: &#39;hsv&#39;, &#39;hot&#39;, &#39;bone&#39;, &#39;tab20c&#39;, &#39;jet&#39;, &#39;seismic&#39;, </span>
<span class="sd">            &#39;viridis&#39;...</span>
<span class="sd">        </span>
<span class="sd">        - vmin, vmax : scalar, optional, default: None</span>
<span class="sd">            `vmin` and `vmax` are used in conjunction with norm to normalize</span>
<span class="sd">            luminance data.  Note if you pass a `norm` instance, your</span>
<span class="sd">            settings for `vmin` and `vmax` will be ignored.</span>
<span class="sd">        </span>
<span class="sd">        - extent : list of scalars [left, right, bottom, top], optional, default: None</span>
<span class="sd">            The location, in data-coordinates, of the lower-left and</span>
<span class="sd">            upper-right corners. If `None`, the image is positioned such that</span>
<span class="sd">            the pixel centers fall on zero-based (row, column) indices.</span>
<span class="sd">        </span>
<span class="sd">        - now : boolean, optional, default : True</span>
<span class="sd">            if True, display now. Cannot display multiple images. </span>
<span class="sd">            To display mutliple images, set now=False until the last call for </span>
<span class="sd">            the last image      </span>
<span class="sd">            </span>
<span class="sd">        ... and more, see matplotlib</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : Figure</span>
<span class="sd">        The Figure instance </span>
<span class="sd">    ax : Axis</span>
<span class="sd">        The Axis instance</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    see plot_extract_alpha_indices.py advanced example for a complete example</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; np.random.seed(2021)</span>
<span class="sd">    &gt;&gt;&gt; M = np.random.rand(10, 10)</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame(M)</span>
<span class="sd">    &gt;&gt;&gt; indices = [&#39;A&#39;,&#39;B&#39;,&#39;C&#39;,&#39;D&#39;,&#39;E&#39;,&#39;F&#39;,&#39;G&#39;,&#39;H&#39;,&#39;I&#39;,&#39;J&#39;]</span>
<span class="sd">    &gt;&gt;&gt; df.columns = indices</span>
<span class="sd">    &gt;&gt;&gt; maad.util.plot_correlation_map(df, R_threshold=0)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Correlation matrix</span>
    <span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>

    <span class="c1"># pop kwargs</span>
    <span class="n">figsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;figsize&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;cmap&quot;</span><span class="p">,</span> <span class="s2">&quot;RdBu_r&quot;</span><span class="p">)</span>
    <span class="n">label_colorbar</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;label_colorbar&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">caxes</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">&gt;</span> <span class="n">R_threshold</span> <span class="o">**</span> <span class="mi">2</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">caxes</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label_colorbar</span><span class="p">)</span>

    <span class="c1"># We want to show all ticks...</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">corr_matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">corr_matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>
    <span class="c1"># ... and label them with the respective list entries</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">corr_matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">corr_matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

    <span class="c1"># Rotate the tick labels, set their alignment and fontsize</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
    <span class="c1"># Rotate the tick labels and set their alignment.</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<span class="c1"># =============================================================================</span>
<div class="viewcode-block" id="false_Color_Spectro"><a class="viewcode-back" href="../../_autosummary/util.visualization.false_Color_Spectro.html#util.false_Color_Spectro">[docs]</a><span class="k">def</span> <span class="nf">false_Color_Spectro</span><span class="p">(</span>
    <span class="n">df</span><span class="p">,</span>
    <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">plim</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">99</span><span class="p">),</span>
    <span class="n">reverseLUT</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">permut</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;minutes&quot;</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">savefig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create False Color Spectrogram from indices obtained by MAAD.</span>
<span class="sd">    Only indices than can be computed bin per bin (ie frequency per frequency)</span>
<span class="sd">    are used to create False Color Spectro. They are called xxx_per_bin.</span>
<span class="sd">        </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : Panda DataFrame</span>
<span class="sd">        DataFrame with indices per frequency bin.</span>
<span class="sd">        </span>
<span class="sd">    indices : list, default is None</span>
<span class="sd">        List of indices. </span>
<span class="sd">        If permut is False (see permut), </span>
<span class="sd">            if indices is None : 1st indices is red (R), 2nd indice is green (G) </span>
<span class="sd">                                 and the 3rd indices is blue (B).</span>
<span class="sd">            if indices is a list of 3 indices or more, only the 3 first indices</span>
<span class="sd">            (triplet) are used to create the false color spectro.</span>
<span class="sd">        if permut is True,</span>
<span class="sd">            if indices is None : All indices in df are used</span>
<span class="sd">            if indices is a list of 3 indices or more, all the indices in the </span>
<span class="sd">            list are used to create the false color spectro with all the </span>
<span class="sd">            possibile permutations.</span>
<span class="sd">    </span>
<span class="sd">    plim : list of 2 scalars, default is (1,99)</span>
<span class="sd">        Set the minimum and maximum percentile to define the min and max value </span>
<span class="sd">        of each indice. These values are then used to clip the values of each </span>
<span class="sd">        indices between these limits.</span>
<span class="sd">             </span>
<span class="sd">    reverseLUT: boolean, default is False</span>
<span class="sd">        LUT : look-up table.</span>
<span class="sd">        if False, the highest indice value is the brigthest color (255) </span>
<span class="sd">        and the lowest indice value is the darkest (0)</span>
<span class="sd">        if True, it&#39;s the reverse order, the highest indice value is the </span>
<span class="sd">        darkest color (0) and the lowest is the brighest (255)     </span>
<span class="sd">    </span>
<span class="sd">    permut : boolean, default is False</span>
<span class="sd">        if True, all the permutations possible for red, green, blue are computed</span>
<span class="sd">        among the list of indices (see indices)</span>
<span class="sd">    </span>
<span class="sd">    unit : string in {&#39;minutes&#39;, &#39;hours&#39;, &#39;days&#39;, &#39;weeks&#39;}, default is &#39;minutes&#39;</span>
<span class="sd">        Select the unit base for x axis</span>
<span class="sd">        </span>
<span class="sd">    verbose : boolean, default is False</span>
<span class="sd">        print indices on the default terminal</span>
<span class="sd">        </span>
<span class="sd">    display : boolean, default is False</span>
<span class="sd">        Display False Color Spectro</span>
<span class="sd">        </span>
<span class="sd">    savefig : string, optional, default is None </span>
<span class="sd">        if not None, figures will be safe. Savefig is the prefix of the save</span>
<span class="sd">        filename.</span>
<span class="sd">    </span>
<span class="sd">    \*\*kwargs, optional</span>
<span class="sd">       - dpi : scalar, optional, default 96</span>
<span class="sd">       - format : str, optional, default .png</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    false_color_image : ndarray of scalars</span>
<span class="sd">        Matrix with ndim = 4 if multiple false color spectro or ndim = 3, if</span>
<span class="sd">        single false color spectro with 3 colors : R, G, B</span>
<span class="sd">            </span>
<span class="sd">    triplet : list</span>
<span class="sd">        List of triplet of indices corresponding to each false color spectro</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    see plot_extract_alpha_indices.py advanced example for a complete example </span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; A_per_bin = [[0.5,0.4,0.3,0.2,0.1],</span>
<span class="sd">                     [0.3,0.3,0.3,0.3,0.3],</span>
<span class="sd">                     [0.5,0.5,0.3,0.0,0.0],</span>
<span class="sd">                     [0.2,0.2,0.3,0.0,0.0],</span>
<span class="sd">                     [0.0,0.0,0.3,0.0,0.0]]</span>
<span class="sd">    &gt;&gt;&gt; B_per_bin = [[0.5,0.5,0.5,0.5,0.5],</span>
<span class="sd">                     [0.5,0.5,0.5,0.5,0.5],</span>
<span class="sd">                     [0.5,0.5,0.2,0.0,0.0],</span>
<span class="sd">                     [0.5,0.2,0.1,0.0,0.0],</span>
<span class="sd">                     [0.5,0.2,0.0,0.0,0.0]]</span>
<span class="sd">    &gt;&gt;&gt; C_per_bin = [[0.0,0.7,0.0,0.5,0.5],</span>
<span class="sd">                     [0.7,0.2,0.0,0.5,0.5],</span>
<span class="sd">                     [0.5,0.5,0.7,0.2,0.2],</span>
<span class="sd">                     [0.0,0.7,0.0,0.2,0.2],</span>
<span class="sd">                     [0.7,0.2,0.0,0.2,0.2]]   </span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame([A_per_bin,B_per_bin,C_per_bin])</span>
<span class="sd">    &gt;&gt;&gt; df = df.T</span>
<span class="sd">    &gt;&gt;&gt; df.columns = [&#39;A_per_bin&#39;,&#39;B_per_bin&#39;,&#39;C_per_bin&#39;]</span>
<span class="sd">    &gt;&gt;&gt; df.index = pd.date_range(&#39;20200101&#39;, periods=len(df))</span>
<span class="sd">    &gt;&gt;&gt; maad.util.false_Color_Spectro (df, display=True ,unit=&#39;days&#39;, figsize=[3,3])</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># sort dataframe by date</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># set index as DatetimeIndex</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
    <span class="c1"># remove column file</span>
    <span class="k">if</span> <span class="s2">&quot;file&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;file&quot;</span><span class="p">)</span>
    <span class="c1"># test if frequencies is in columns</span>
    <span class="k">if</span> <span class="s2">&quot;frequencies&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="c1"># get frequencies and remove the column</span>
        <span class="c1"># test if type of df[&#39;frequencies&#39;] is number or str</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;frequencies&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">literal_eval</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;frequencies&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># drop frequencies</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;frequencies&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>

    <span class="c1"># Set the list of indices if indices is None</span>
    <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="c1"># for each indice, check if values type is string and convert into scalars</span>
    <span class="c1"># Values are vectors of strings when data are loading from csv</span>
    <span class="k">for</span> <span class="n">indice</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
        <span class="c1"># test if type of df[indice] is string</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">indice</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># convert string into scalars</span>
            <span class="n">df</span><span class="p">[</span><span class="n">indice</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">indice</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">literal_eval</span><span class="p">)</span>

    <span class="c1"># create a dataframe with normalized values for each indices</span>
    <span class="n">df_z</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">indice</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">indice</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">indice</span><span class="p">]:</span>
            <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># Select the min and max value for each indice</span>
        <span class="n">z_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">plim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">z_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">plim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># clip the value to the min and max found</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span><span class="p">)</span>
        <span class="c1"># linear conversion</span>
        <span class="k">if</span> <span class="n">reverseLUT</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># between 1 to 0</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">linear_scale</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># between 0 to 1</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">linear_scale</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">df_z</span><span class="p">[</span><span class="n">indice</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">z</span> <span class="o">*</span> <span class="mi">255</span><span class="p">]</span>

    <span class="c1"># find all permutation of 3 indices among all indices</span>
    <span class="k">if</span> <span class="n">permut</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">itertools</span>

        <span class="n">per</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">permutations</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df_z</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">triplet</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">per</span><span class="p">:</span>
            <span class="n">triplet</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">*</span><span class="n">val</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">triplet</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">triplet</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">triplet</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">triplet</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">triplet</span> <span class="o">=</span> <span class="p">[</span><span class="n">triplet</span><span class="p">]</span>

    <span class="c1">#####################</span>

    <span class="c1"># get the number of pixels along frequency (Nf) and time (Nt)</span>
    <span class="n">Nf</span><span class="p">,</span> <span class="n">Nt</span> <span class="o">=</span> <span class="n">df_z</span><span class="p">[</span><span class="n">triplet</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>

    <span class="c1"># test if figsize is in kwargs</span>
    <span class="n">figsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;figsize&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="c1"># if figsize is not in kwargs</span>
    <span class="k">if</span> <span class="n">figsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">Nt</span> <span class="o">/</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">Nf</span> <span class="o">/</span> <span class="mi">512</span><span class="p">)</span>

    <span class="n">fig_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;figsize&quot;</span><span class="p">:</span> <span class="n">figsize</span><span class="p">,</span> <span class="s2">&quot;tight_layout&quot;</span><span class="p">:</span> <span class="s2">&quot;tight_layout&quot;</span><span class="p">}</span>

    <span class="c1"># number of days in the period</span>
    <span class="n">deltaT</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

    <span class="c1"># unit</span>
    <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;minutes&quot;</span><span class="p">:</span>
        <span class="n">normT</span> <span class="o">=</span> <span class="mf">60e9</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;Minutes&quot;</span>
    <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;hours&quot;</span><span class="p">:</span>
        <span class="n">normT</span> <span class="o">=</span> <span class="mf">60e9</span> <span class="o">*</span> <span class="mi">60</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;Hours&quot;</span>
    <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;days&quot;</span><span class="p">:</span>
        <span class="n">normT</span> <span class="o">=</span> <span class="mf">60e9</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;Days&quot;</span>
    <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;weeks&quot;</span><span class="p">:</span>
        <span class="n">normT</span> <span class="o">=</span> <span class="mf">60e9</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">7</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;Weeks&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">normT</span> <span class="o">=</span> <span class="mf">60e9</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;Minutes&quot;</span>

    <span class="n">false_color_image</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">triplet</span><span class="p">)):</span>

        <span class="c1"># create the false color image (R,G,B)</span>
        <span class="n">z0</span> <span class="o">=</span> <span class="n">df_z</span><span class="p">[</span><span class="n">triplet</span><span class="p">[</span><span class="n">tt</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">z1</span> <span class="o">=</span> <span class="n">df_z</span><span class="p">[</span><span class="n">triplet</span><span class="p">[</span><span class="n">tt</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">z2</span> <span class="o">=</span> <span class="n">df_z</span><span class="p">[</span><span class="n">triplet</span><span class="p">[</span><span class="n">tt</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">false_color_image</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">z0</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">)))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>

        <span class="c1"># Display the False Color Spectro</span>
        <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;font.size&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;font.family&quot;</span><span class="p">:</span> <span class="s2">&quot;serif&quot;</span><span class="p">})</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">fig_kwargs</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
                <span class="n">false_color_image</span><span class="p">[</span><span class="n">tt</span><span class="p">],</span>
                <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
                <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span>
                <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="n">fn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">deltaT</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="n">normT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fn</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
                <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
                <span class="s2">&quot;False Color Spectro &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="s2">&quot; [R:&quot;</span>
                <span class="o">+</span> <span class="n">triplet</span><span class="p">[</span><span class="n">tt</span><span class="p">][</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">8</span><span class="p">]</span>
                <span class="o">+</span> <span class="s2">&quot;; &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;G:&quot;</span>
                <span class="o">+</span> <span class="n">triplet</span><span class="p">[</span><span class="n">tt</span><span class="p">][</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">8</span><span class="p">]</span>
                <span class="o">+</span> <span class="s2">&quot;; &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;B:&quot;</span>
                <span class="o">+</span> <span class="n">triplet</span><span class="p">[</span><span class="n">tt</span><span class="p">][</span><span class="mi">2</span><span class="p">][:</span><span class="o">-</span><span class="mi">8</span><span class="p">]</span>
                <span class="o">+</span> <span class="s2">&quot;]&quot;</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

            <span class="c1"># SAVE FIGURE</span>
            <span class="k">if</span> <span class="n">savefig</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dpi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;dpi&quot;</span><span class="p">,</span> <span class="mi">96</span><span class="p">)</span>
                <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s2">&quot;tight&quot;</span>
                <span class="nb">format</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;format&quot;</span><span class="p">,</span> <span class="s2">&quot;png&quot;</span><span class="p">)</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;_fcs_&quot;</span>
                    <span class="o">+</span> <span class="n">triplet</span><span class="p">[</span><span class="n">tt</span><span class="p">][</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">8</span><span class="p">]</span>
                    <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
                    <span class="o">+</span> <span class="n">triplet</span><span class="p">[</span><span class="n">tt</span><span class="p">][</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">8</span><span class="p">]</span>
                    <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
                    <span class="o">+</span> <span class="n">triplet</span><span class="p">[</span><span class="n">tt</span><span class="p">][</span><span class="mi">2</span><span class="p">][:</span><span class="o">-</span><span class="mi">8</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">full_filename</span> <span class="o">=</span> <span class="n">savefig</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nb">format</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="s2">&quot;save figure : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">full_filename</span><span class="p">)</span>
                <span class="c1"># save fig</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
                    <span class="n">fname</span><span class="o">=</span><span class="n">full_filename</span><span class="p">,</span>
                    <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
                    <span class="n">bbox_inches</span><span class="o">=</span><span class="n">bbox_inches</span><span class="p">,</span>
                    <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span>
                <span class="p">)</span>
                <span class="c1"># close fig</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="c1"># convert into ndarray</span>
    <span class="n">false_color_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">false_color_image</span><span class="p">)</span>

    <span class="c1"># test if there is only one False Color Spectro, then, remove the 1st dim</span>
    <span class="k">if</span> <span class="n">false_color_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">false_color_image</span> <span class="o">=</span> <span class="n">false_color_image</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">triplet</span> <span class="o">=</span> <span class="n">triplet</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">false_color_image</span><span class="p">,</span> <span class="n">triplet</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, scikit-maad development team.

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    

  <style>
         .wy-nav-content { max-width: none; }
  </style>



</body>
</html>