

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>USE MULTICPU FUNCTIONALITY TO COMPUTE INDICES &mdash; scikit-maad 1.3.12 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery-dataframe.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Download audio files from Xeno-Canto and automatically extract characteristics" href="wookpecker_drumming_characteristics.html" />
    <link rel="prev" title="Extract acoustic indices from audio recordings" href="plot_extract_alpha_indices.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> scikit-maad
          

          
            
            <img src="../../_static/logo_maad_white.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.3.12
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../audio_dataset.html">Audio dataset</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../sound.html">Sound processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rois.html">Segmentation methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../features.html">Acoustic features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spl.html">Sound pressure level</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../util.html">Utilities</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Example Gallery</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Example gallery</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#basic-examples">Basic examples</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#advanced-examples">Advanced examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="plot_nmf_and_false_color_spectrogram.html">Signal decomposition and false-color spectrograms</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_remove_background.html">Remove background noise with signal processing tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_unsupervised_sound_classification.html">Classify soundtypes with unsupervised learning</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_sound_degradation_due_to_attenuation.html">Simulation of sound degradation due to geometric, atmospheric and habitat attenuation</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_xenocanto_wookpecker_activities.html">Download metadata from Xeno-Canto to infer species activities</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_sound_pressure_level.html">Estimate sound pressure level from audio recordings</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_compare_auto_and_manual_rois_selection.html">Find Regions of interest (ROIs) in a spectrogram</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_extract_alpha_indices.html">Extract acoustic indices from audio recordings</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">USE MULTICPU FUNCTIONALITY TO COMPUTE INDICES</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#set-variables">Set Variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#define-the-function-that-will-be-used-for-batch-processing">Define the function that will be used for batch processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#display-the-comparison-between-to-methods">Display the comparison between to methods</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="wookpecker_drumming_characteristics.html">Download audio files from Xeno-Canto and automatically extract characteristics</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">scikit-maad</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Example gallery</a> &raquo;</li>
        
      <li>USE MULTICPU FUNCTIONALITY TO COMPUTE INDICES</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/_auto_examples/2_advanced/plot_extract_alpha_indices_multicpu.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-examples-2-advanced-plot-extract-alpha-indices-multicpu-py"><span class="std std-ref">here</span></a>     to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="use-multicpu-functionality-to-compute-indices">
<span id="sphx-glr-auto-examples-2-advanced-plot-extract-alpha-indices-multicpu-py"></span><h1>USE MULTICPU FUNCTIONALITY TO COMPUTE INDICES<a class="headerlink" href="#use-multicpu-functionality-to-compute-indices" title="Permalink to this heading">¶</a></h1>
<p>Acoustic indices can summarize aspects of the acoustic energy distribution in
audio recordings and are widely used to characterize animal acoustic communities[1-3].
In this example, we will see how to eficiently compute multiple acoustic indices,
and present basics post-processing posibilities. The audio recordings used in this
example can be downloaded from the open GitHub repository
(<a class="reference external" href="https://github.com/scikit-maad/scikit-maad/tree/production/data">https://github.com/scikit-maad/scikit-maad/tree/production/data</a>).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># sphinx_gallery_thumbnail_path = &#39;./_images/sphx_glr_plot_extract_alpha_indices_multicpu_001.png&#39;</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Parallel processing packages</span>
<span class="c1"># from functools import partial</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">concurrent</span> <span class="kn">import</span> <span class="n">futures</span>

<span class="kn">from</span> <span class="nn">maad</span> <span class="kn">import</span> <span class="n">sound</span><span class="p">,</span> <span class="n">features</span>
<span class="kn">from</span> <span class="nn">maad.util</span> <span class="kn">import</span> <span class="n">date_parser</span>
</pre></div>
</div>
<section id="set-variables">
<h2>Set Variables<a class="headerlink" href="#set-variables" title="Permalink to this heading">¶</a></h2>
<p>We list all spectral and temporal acoustic indices that will be computed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">SPECTRAL_FEATURES</span></a><span class="o">=</span><span class="p">[</span><span class="s1">&#39;MEANf&#39;</span><span class="p">,</span><span class="s1">&#39;VARf&#39;</span><span class="p">,</span><span class="s1">&#39;SKEWf&#39;</span><span class="p">,</span><span class="s1">&#39;KURTf&#39;</span><span class="p">,</span><span class="s1">&#39;NBPEAKS&#39;</span><span class="p">,</span><span class="s1">&#39;LEQf&#39;</span><span class="p">,</span>
<span class="s1">&#39;ENRf&#39;</span><span class="p">,</span><span class="s1">&#39;BGNf&#39;</span><span class="p">,</span><span class="s1">&#39;SNRf&#39;</span><span class="p">,</span><span class="s1">&#39;Hf&#39;</span><span class="p">,</span> <span class="s1">&#39;EAS&#39;</span><span class="p">,</span><span class="s1">&#39;ECU&#39;</span><span class="p">,</span><span class="s1">&#39;ECV&#39;</span><span class="p">,</span><span class="s1">&#39;EPS&#39;</span><span class="p">,</span><span class="s1">&#39;EPS_KURT&#39;</span><span class="p">,</span><span class="s1">&#39;EPS_SKEW&#39;</span><span class="p">,</span><span class="s1">&#39;ACI&#39;</span><span class="p">,</span>
<span class="s1">&#39;NDSI&#39;</span><span class="p">,</span><span class="s1">&#39;rBA&#39;</span><span class="p">,</span><span class="s1">&#39;AnthroEnergy&#39;</span><span class="p">,</span><span class="s1">&#39;BioEnergy&#39;</span><span class="p">,</span><span class="s1">&#39;BI&#39;</span><span class="p">,</span><span class="s1">&#39;ROU&#39;</span><span class="p">,</span><span class="s1">&#39;ADI&#39;</span><span class="p">,</span><span class="s1">&#39;AEI&#39;</span><span class="p">,</span><span class="s1">&#39;LFC&#39;</span><span class="p">,</span><span class="s1">&#39;MFC&#39;</span><span class="p">,</span><span class="s1">&#39;HFC&#39;</span><span class="p">,</span>
<span class="s1">&#39;ACTspFract&#39;</span><span class="p">,</span><span class="s1">&#39;ACTspCount&#39;</span><span class="p">,</span><span class="s1">&#39;ACTspMean&#39;</span><span class="p">,</span> <span class="s1">&#39;EVNspFract&#39;</span><span class="p">,</span><span class="s1">&#39;EVNspMean&#39;</span><span class="p">,</span><span class="s1">&#39;EVNspCount&#39;</span><span class="p">,</span>
<span class="s1">&#39;TFSD&#39;</span><span class="p">,</span><span class="s1">&#39;H_Havrda&#39;</span><span class="p">,</span><span class="s1">&#39;H_Renyi&#39;</span><span class="p">,</span><span class="s1">&#39;H_pairedShannon&#39;</span><span class="p">,</span> <span class="s1">&#39;H_gamma&#39;</span><span class="p">,</span> <span class="s1">&#39;H_GiniSimpson&#39;</span><span class="p">,</span><span class="s1">&#39;RAOQ&#39;</span><span class="p">,</span>
<span class="s1">&#39;AGI&#39;</span><span class="p">,</span><span class="s1">&#39;ROItotal&#39;</span><span class="p">,</span><span class="s1">&#39;ROIcover&#39;</span><span class="p">]</span>

<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">TEMPORAL_FEATURES</span></a><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ZCR&#39;</span><span class="p">,</span><span class="s1">&#39;MEANt&#39;</span><span class="p">,</span> <span class="s1">&#39;VARt&#39;</span><span class="p">,</span> <span class="s1">&#39;SKEWt&#39;</span><span class="p">,</span> <span class="s1">&#39;KURTt&#39;</span><span class="p">,</span>
               <span class="s1">&#39;LEQt&#39;</span><span class="p">,</span><span class="s1">&#39;BGNt&#39;</span><span class="p">,</span> <span class="s1">&#39;SNRt&#39;</span><span class="p">,</span><span class="s1">&#39;MED&#39;</span><span class="p">,</span> <span class="s1">&#39;Ht&#39;</span><span class="p">,</span><span class="s1">&#39;ACTtFraction&#39;</span><span class="p">,</span> <span class="s1">&#39;ACTtCount&#39;</span><span class="p">,</span>
               <span class="s1">&#39;ACTtMean&#39;</span><span class="p">,</span><span class="s1">&#39;EVNtFraction&#39;</span><span class="p">,</span> <span class="s1">&#39;EVNtMean&#39;</span><span class="p">,</span> <span class="s1">&#39;EVNtCount&#39;</span><span class="p">]</span>

<span class="c1"># Parameters of the audio recorder. This is not a mandatory but it allows</span>
<span class="c1"># to compute the sound pressure level of the audio file (dB SPL) as a</span>
<span class="c1"># sonometer would do.</span>
<a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">S</span></a> <span class="o">=</span> <span class="o">-</span><span class="mi">35</span>         <span class="c1"># Sensbility microphone-35dBV (SM4) / -18dBV (Audiomoth)</span>
<a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">G</span></a> <span class="o">=</span> <span class="mi">26</span><span class="o">+</span><span class="mi">16</span>       <span class="c1"># Amplification gain (26dB (SM4 preamplifier))</span>
</pre></div>
</div>
<p>We parse the directory were the audio dataset is located in order to get a df with date
and fullfilename. As the data were collected with a SM4 audio recording device
we set the dateformat agument to ‘SM4’ in order to be able to parse the date
from the filename. In case of Audiomoth, the date is coded as Hex in the
filename. The path to the audio dataset is “../../data/indices/”.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">date_parser</span><span class="p">(</span><span class="s2">&quot;../../data/indices/&quot;</span><span class="p">,</span> <span class="n">dateformat</span><span class="o">=</span><span class="s1">&#39;SM4&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Date is used as index. Reset the index in order to get back Date as column</span>
<span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>indices.csv
per_bin_indices.csv
S4A03895_20190522_000000.wav
S4A03895_20190522_001500.wav
S4A03895_20190522_003000.wav
S4A03895_20190522_004500.wav
S4A03895_20190522_010000.wav
S4A03895_20190522_011500.wav
S4A03895_20190522_013000.wav
S4A03895_20190522_014500.wav
S4A03895_20190522_020000.wav
S4A03895_20190522_021500.wav
S4A03895_20190522_023000.wav
S4A03895_20190522_024500.wav
S4A03895_20190522_030000.wav
S4A03895_20190522_031500.wav
S4A03895_20190522_033000.wav
S4A03895_20190522_034500.wav
S4A03895_20190522_040000.wav
S4A03895_20190522_041500.wav
S4A03895_20190522_043000.wav
S4A03895_20190522_044500.wav
S4A03895_20190522_050000.wav
S4A03895_20190522_051500.wav
S4A03895_20190522_053000.wav
S4A03895_20190522_054500.wav
S4A03895_20190522_060000.wav
S4A03895_20190522_061500.wav
S4A03895_20190522_063000.wav
S4A03895_20190522_064500.wav
S4A03895_20190522_070000.wav
S4A03895_20190522_071500.wav
S4A03895_20190522_073000.wav
S4A03895_20190522_074500.wav
S4A03895_20190522_080000.wav
S4A03895_20190522_081500.wav
S4A03895_20190522_083000.wav
S4A03895_20190522_084500.wav
S4A03895_20190522_090000.wav
S4A03895_20190522_091500.wav
S4A03895_20190522_093000.wav
S4A03895_20190522_094500.wav
S4A03895_20190522_100000.wav
S4A03895_20190522_101500.wav
S4A03895_20190522_103000.wav
S4A03895_20190522_104500.wav
S4A03895_20190522_110000.wav
S4A03895_20190522_111500.wav
S4A03895_20190522_113000.wav
S4A03895_20190522_114500.wav
S4A03895_20190522_120000.wav
S4A03895_20190522_121500.wav
S4A03895_20190522_123000.wav
S4A03895_20190522_124500.wav
S4A03895_20190522_130000.wav
S4A03895_20190522_131500.wav
S4A03895_20190522_133000.wav
S4A03895_20190522_134500.wav
S4A03895_20190522_140000.wav
S4A03895_20190522_141500.wav
S4A03895_20190522_143000.wav
S4A03895_20190522_144500.wav
S4A03895_20190522_150000.wav
S4A03895_20190522_151500.wav
S4A03895_20190522_153000.wav
S4A03895_20190522_154500.wav
S4A03895_20190522_160000.wav
S4A03895_20190522_161500.wav
S4A03895_20190522_163000.wav
S4A03895_20190522_164500.wav
S4A03895_20190522_170000.wav
S4A03895_20190522_171500.wav
S4A03895_20190522_173000.wav
S4A03895_20190522_174500.wav
S4A03895_20190522_180000.wav
S4A03895_20190522_181500.wav
S4A03895_20190522_183000.wav
S4A03895_20190522_184500.wav
S4A03895_20190522_190000.wav
S4A03895_20190522_191500.wav
S4A03895_20190522_193000.wav
S4A03895_20190522_194500.wav
S4A03895_20190522_200000.wav
S4A03895_20190522_201500.wav
S4A03895_20190522_203000.wav
S4A03895_20190522_204500.wav
S4A03895_20190522_210000.wav
S4A03895_20190522_211500.wav
S4A03895_20190522_213000.wav
S4A03895_20190522_214500.wav
S4A03895_20190522_220000.wav
S4A03895_20190522_221500.wav
S4A03895_20190522_223000.wav
S4A03895_20190522_224500.wav
S4A03895_20190522_230000.wav
S4A03895_20190522_231500.wav
S4A03895_20190522_233000.wav
S4A03895_20190522_234500.wav
</pre></div>
</div>
</section>
<section id="define-the-function-that-will-be-used-for-batch-processing">
<h2>Define the function that will be used for batch processing<a class="headerlink" href="#define-the-function-that-will-be-used-for-batch-processing" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># This function should work by itself without waiting for another process</span>
<span class="c1"># Here we defined a function to process a single audio file. The input arguments</span>
<span class="c1"># are the path to the audio file and the recording date of the audio file. Both</span>
<span class="c1"># arguments are in the dataframe df given by the function date_parser.</span>

<span class="k">def</span> <span class="nf">single_file_processing</span> <span class="p">(</span><span class="n">audio_path</span><span class="p">,</span>
                            <span class="n">date</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    audio_path : string</span>
<span class="sd">        full path to the audio file (.wav) to process.</span>
<span class="sd">        The full path is in the dataframe given by the function date_parser</span>
<span class="sd">    date : datetime</span>
<span class="sd">        date of recording of the audio file.</span>
<span class="sd">        The date is in the dataframe given by the function date_parser</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    df_indices : dataframe</span>
<span class="sd">        Dataframe containing all the temporal and spectral indices, as well as</span>
<span class="sd">        the audio path (&#39;file&#39; column) and the recording date (&#39;Date&#39; column)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Load the original sound (16bits) and get the sampling frequency fs</span>
    <span class="k">try</span> <span class="p">:</span>
        <span class="n">wave</span><span class="p">,</span><span class="n">fs</span> <span class="o">=</span> <span class="n">sound</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">audio_path</span><span class="p">,</span>
                             <span class="n">channel</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                             <span class="n">detrend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                             <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot; ===================================================================</span>
<span class="sd">                         Computation in the time domain</span>
<span class="sd">        ====================================================================&quot;&quot;&quot;</span>

        <span class="c1"># compute all the audio indices and store them into a DataFrame</span>
        <span class="c1"># dB_threshold and rejectDuration are used to select audio events.</span>
        <span class="n">df_audio_ind</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">all_temporal_alpha_indices</span><span class="p">(</span>
                                    <span class="n">wave</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span>
                                    <span class="n">gain</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">G</span></a><span class="p">,</span> <span class="n">sensibility</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">S</span></a><span class="p">,</span>
                                    <span class="n">dB_threshold</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">rejectDuration</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
                                    <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">display</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot; ===================================================================</span>
<span class="sd">                         Computation in the frequency domain</span>
<span class="sd">        ====================================================================&quot;&quot;&quot;</span>

        <span class="c1"># Compute the Power Spectrogram Density (PSD) : Sxx_power</span>
        <span class="n">Sxx_power</span><span class="p">,</span><span class="n">tn</span><span class="p">,</span><span class="n">fn</span><span class="p">,</span><span class="n">ext</span> <span class="o">=</span> <span class="n">sound</span><span class="o">.</span><span class="n">spectrogram</span> <span class="p">(</span>
                                        <span class="n">wave</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="s1">&#39;hanning&#39;</span><span class="p">,</span>
                                        <span class="n">nperseg</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span> <span class="n">noverlap</span><span class="o">=</span><span class="mi">1024</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span>
                                        <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">display</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                        <span class="n">savefig</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># compute all the spectral indices and store them into a DataFrame</span>
        <span class="c1"># flim_low, flim_mid, flim_hi corresponds to the frequency limits in Hz</span>
        <span class="c1"># that are required to compute somes indices (i.e. NDSI)</span>
        <span class="c1"># if R_compatible is set to &#39;soundecology&#39;, then the output are similar to</span>
        <span class="c1"># soundecology R package.</span>
        <span class="c1"># mask_param1 and mask_param2 are two parameters to find the regions of</span>
        <span class="c1"># interest (ROIs). These parameters need to be adapted to the dataset in</span>
        <span class="c1"># order to select ROIs</span>
        <span class="n">df_spec_ind</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">all_spectral_alpha_indices</span><span class="p">(</span>
                                                <span class="n">Sxx_power</span><span class="p">,</span>
                                                <span class="n">tn</span><span class="p">,</span><span class="n">fn</span><span class="p">,</span>
                                                <span class="n">flim_low</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1500</span><span class="p">],</span>
                                                <span class="n">flim_mid</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1500</span><span class="p">,</span><span class="mi">8000</span><span class="p">],</span>
                                                <span class="n">flim_hi</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">8000</span><span class="p">,</span><span class="mi">20000</span><span class="p">],</span>
                                                <span class="n">gain</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">G</span></a><span class="p">,</span> <span class="n">sensitivity</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">S</span></a><span class="p">,</span>
                                                <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                                <span class="n">R_compatible</span> <span class="o">=</span> <span class="s1">&#39;soundecology&#39;</span><span class="p">,</span>
                                                <span class="n">mask_param1</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
                                                <span class="n">mask_param2</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                                <span class="n">display</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot; ===================================================================</span>
<span class="sd">                         Create a dataframe</span>
<span class="sd">        ====================================================================&quot;&quot;&quot;</span>
        <span class="c1"># add scalar indices into the df_indices dataframe</span>
        <span class="n">df_indices</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_audio_ind</span><span class="p">,</span>
                                <span class="n">df_spec_ind</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># add date and audio_path</span>
        <span class="n">df_indices</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
        <span class="n">df_indices</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="n">audio_path</span><span class="p">)</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="c1"># if an error occur, send an empty output</span>
        <span class="n">df_indices</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">df_indices</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot; ===========================================================================</span>
<span class="sd">                 Mono CPU</span>
<span class="sd">============================================================================&quot;&quot;&quot;</span>
<span class="c1"># Only one cpu is used to process all data in dataframe, row by row.</span>
<span class="c1"># This is the common way to process the data but it has some limitations :</span>
<span class="c1"># - only 1 CPU is used even if the computer has more CPUs.</span>
<span class="c1"># - data are sequentially processed which means each file will wait for the</span>
<span class="c1"># completion of the previous file in the list. If 1 file requires more time to</span>
<span class="c1"># be processed, the time to complete the overall process will take longer.</span>

<span class="c1"># create an empty dataframe. It will contain all ROIs found for each</span>
<span class="c1"># audio file in the directory</span>
<span class="n">df_indices</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

<a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">tic</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/time.html#time.perf_counter" title="time.perf_counter" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span></a><span class="p">()</span>
<span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;unique cpu indices calculation...&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
    <span class="k">for</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">index</span></a><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span> <span class="p">:</span>
        <span class="n">df_indices_temp</span> <span class="o">=</span> <span class="n">single_file_processing</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">])</span>
        <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">df_indices</span> <span class="o">=</span> <span class="n">df_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_indices_temp</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">toc</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/time.html#time.perf_counter" title="time.perf_counter" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span></a><span class="p">()</span>

<span class="c1"># time duration of the process</span>
<a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">monocpu_duration</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">toc</span></a> <span class="o">-</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">tic</span></a>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Elapsed time is </span><span class="si">{</span><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">monocpu_duration</span></a><span class="si">:</span><span class="s2">0.1f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>unique cpu indices calculation...:   0%|          | 0/96 [00:00&lt;?, ?it/s]
unique cpu indices calculation...:   1%|1         | 1/96 [00:00&lt;00:23,  4.06it/s]
unique cpu indices calculation...:   2%|2         | 2/96 [00:00&lt;00:20,  4.48it/s]
unique cpu indices calculation...:   3%|3         | 3/96 [00:00&lt;00:20,  4.64it/s]
unique cpu indices calculation...:   4%|4         | 4/96 [00:00&lt;00:19,  4.76it/s]
unique cpu indices calculation...:   5%|5         | 5/96 [00:01&lt;00:18,  4.81it/s]
unique cpu indices calculation...:   6%|6         | 6/96 [00:01&lt;00:19,  4.73it/s]
unique cpu indices calculation...:   7%|7         | 7/96 [00:01&lt;00:19,  4.66it/s]
unique cpu indices calculation...:   8%|8         | 8/96 [00:01&lt;00:18,  4.64it/s]
unique cpu indices calculation...:   9%|9         | 9/96 [00:01&lt;00:19,  4.56it/s]
unique cpu indices calculation...:  10%|#         | 10/96 [00:02&lt;00:18,  4.53it/s]
unique cpu indices calculation...:  11%|#1        | 11/96 [00:02&lt;00:18,  4.59it/s]
unique cpu indices calculation...:  12%|#2        | 12/96 [00:02&lt;00:18,  4.60it/s]
unique cpu indices calculation...:  14%|#3        | 13/96 [00:02&lt;00:18,  4.59it/s]
unique cpu indices calculation...:  15%|#4        | 14/96 [00:03&lt;00:17,  4.56it/s]
unique cpu indices calculation...:  16%|#5        | 15/96 [00:03&lt;00:17,  4.60it/s]
unique cpu indices calculation...:  17%|#6        | 16/96 [00:03&lt;00:17,  4.68it/s]
unique cpu indices calculation...:  18%|#7        | 17/96 [00:03&lt;00:16,  4.67it/s]
unique cpu indices calculation...:  19%|#8        | 18/96 [00:03&lt;00:16,  4.63it/s]
unique cpu indices calculation...:  20%|#9        | 19/96 [00:04&lt;00:16,  4.59it/s]
unique cpu indices calculation...:  21%|##        | 20/96 [00:04&lt;00:16,  4.60it/s]
unique cpu indices calculation...:  22%|##1       | 21/96 [00:04&lt;00:16,  4.55it/s]
unique cpu indices calculation...:  23%|##2       | 22/96 [00:04&lt;00:17,  4.30it/s]
unique cpu indices calculation...:  24%|##3       | 23/96 [00:05&lt;00:17,  4.17it/s]
unique cpu indices calculation...:  25%|##5       | 24/96 [00:05&lt;00:17,  4.01it/s]
unique cpu indices calculation...:  26%|##6       | 25/96 [00:05&lt;00:17,  4.01it/s]
unique cpu indices calculation...:  27%|##7       | 26/96 [00:05&lt;00:17,  3.97it/s]
unique cpu indices calculation...:  28%|##8       | 27/96 [00:06&lt;00:17,  3.89it/s]
unique cpu indices calculation...:  29%|##9       | 28/96 [00:06&lt;00:17,  3.98it/s]
unique cpu indices calculation...:  30%|###       | 29/96 [00:06&lt;00:16,  4.07it/s]
unique cpu indices calculation...:  31%|###1      | 30/96 [00:07&lt;00:21,  3.08it/s]
unique cpu indices calculation...:  32%|###2      | 31/96 [00:07&lt;00:19,  3.31it/s]
unique cpu indices calculation...:  33%|###3      | 32/96 [00:07&lt;00:18,  3.49it/s]
unique cpu indices calculation...:  34%|###4      | 33/96 [00:07&lt;00:17,  3.68it/s]
unique cpu indices calculation...:  35%|###5      | 34/96 [00:08&lt;00:17,  3.59it/s]
unique cpu indices calculation...:  36%|###6      | 35/96 [00:08&lt;00:17,  3.40it/s]
unique cpu indices calculation...:  38%|###7      | 36/96 [00:08&lt;00:18,  3.27it/s]
unique cpu indices calculation...:  39%|###8      | 37/96 [00:09&lt;00:17,  3.42it/s]
unique cpu indices calculation...:  40%|###9      | 38/96 [00:09&lt;00:16,  3.60it/s]
unique cpu indices calculation...:  41%|####      | 39/96 [00:09&lt;00:15,  3.64it/s]
unique cpu indices calculation...:  42%|####1     | 40/96 [00:09&lt;00:14,  3.74it/s]
unique cpu indices calculation...:  43%|####2     | 41/96 [00:10&lt;00:14,  3.72it/s]
unique cpu indices calculation...:  44%|####3     | 42/96 [00:10&lt;00:13,  3.90it/s]
unique cpu indices calculation...:  45%|####4     | 43/96 [00:10&lt;00:13,  3.95it/s]
unique cpu indices calculation...:  46%|####5     | 44/96 [00:10&lt;00:12,  4.05it/s]
unique cpu indices calculation...:  47%|####6     | 45/96 [00:11&lt;00:12,  4.12it/s]
unique cpu indices calculation...:  48%|####7     | 46/96 [00:11&lt;00:13,  3.81it/s]
unique cpu indices calculation...:  49%|####8     | 47/96 [00:11&lt;00:12,  3.93it/s]
unique cpu indices calculation...:  50%|#####     | 48/96 [00:11&lt;00:12,  3.99it/s]
unique cpu indices calculation...:  51%|#####1    | 49/96 [00:12&lt;00:11,  4.04it/s]
unique cpu indices calculation...:  52%|#####2    | 50/96 [00:12&lt;00:11,  4.12it/s]
unique cpu indices calculation...:  53%|#####3    | 51/96 [00:12&lt;00:11,  3.90it/s]
unique cpu indices calculation...:  54%|#####4    | 52/96 [00:12&lt;00:10,  4.03it/s]
unique cpu indices calculation...:  55%|#####5    | 53/96 [00:13&lt;00:10,  4.00it/s]
unique cpu indices calculation...:  56%|#####6    | 54/96 [00:13&lt;00:10,  4.04it/s]
unique cpu indices calculation...:  57%|#####7    | 55/96 [00:13&lt;00:13,  3.15it/s]
unique cpu indices calculation...:  58%|#####8    | 56/96 [00:14&lt;00:11,  3.39it/s]
unique cpu indices calculation...:  59%|#####9    | 57/96 [00:14&lt;00:11,  3.51it/s]
unique cpu indices calculation...:  60%|######    | 58/96 [00:14&lt;00:10,  3.71it/s]
unique cpu indices calculation...:  61%|######1   | 59/96 [00:14&lt;00:09,  3.83it/s]
unique cpu indices calculation...:  62%|######2   | 60/96 [00:14&lt;00:09,  3.97it/s]
unique cpu indices calculation...:  64%|######3   | 61/96 [00:15&lt;00:08,  4.16it/s]
unique cpu indices calculation...:  65%|######4   | 62/96 [00:15&lt;00:08,  4.22it/s]
unique cpu indices calculation...:  66%|######5   | 63/96 [00:15&lt;00:07,  4.30it/s]
unique cpu indices calculation...:  67%|######6   | 64/96 [00:15&lt;00:07,  4.26it/s]
unique cpu indices calculation...:  68%|######7   | 65/96 [00:16&lt;00:07,  4.26it/s]
unique cpu indices calculation...:  69%|######8   | 66/96 [00:16&lt;00:06,  4.33it/s]
unique cpu indices calculation...:  70%|######9   | 67/96 [00:16&lt;00:06,  4.43it/s]
unique cpu indices calculation...:  71%|#######   | 68/96 [00:16&lt;00:06,  4.49it/s]
unique cpu indices calculation...:  72%|#######1  | 69/96 [00:17&lt;00:05,  4.52it/s]
unique cpu indices calculation...:  73%|#######2  | 70/96 [00:17&lt;00:05,  4.54it/s]
unique cpu indices calculation...:  74%|#######3  | 71/96 [00:17&lt;00:05,  4.49it/s]
unique cpu indices calculation...:  75%|#######5  | 72/96 [00:17&lt;00:05,  4.47it/s]
unique cpu indices calculation...:  76%|#######6  | 73/96 [00:17&lt;00:05,  4.45it/s]
unique cpu indices calculation...:  77%|#######7  | 74/96 [00:18&lt;00:05,  4.37it/s]
unique cpu indices calculation...:  78%|#######8  | 75/96 [00:18&lt;00:04,  4.37it/s]
unique cpu indices calculation...:  79%|#######9  | 76/96 [00:18&lt;00:04,  4.42it/s]
unique cpu indices calculation...:  80%|########  | 77/96 [00:18&lt;00:04,  4.40it/s]
unique cpu indices calculation...:  81%|########1 | 78/96 [00:19&lt;00:04,  4.35it/s]
unique cpu indices calculation...:  82%|########2 | 79/96 [00:19&lt;00:03,  4.30it/s]
unique cpu indices calculation...:  83%|########3 | 80/96 [00:19&lt;00:03,  4.27it/s]
unique cpu indices calculation...:  84%|########4 | 81/96 [00:19&lt;00:03,  4.27it/s]
unique cpu indices calculation...:  85%|########5 | 82/96 [00:20&lt;00:03,  4.15it/s]
unique cpu indices calculation...:  86%|########6 | 83/96 [00:20&lt;00:03,  4.13it/s]
unique cpu indices calculation...:  88%|########7 | 84/96 [00:20&lt;00:02,  4.06it/s]
unique cpu indices calculation...:  89%|########8 | 85/96 [00:20&lt;00:02,  4.09it/s]
unique cpu indices calculation...:  90%|########9 | 86/96 [00:21&lt;00:02,  3.41it/s]
unique cpu indices calculation...:  91%|######### | 87/96 [00:21&lt;00:02,  3.18it/s]
unique cpu indices calculation...:  92%|#########1| 88/96 [00:21&lt;00:02,  3.28it/s]
unique cpu indices calculation...:  93%|#########2| 89/96 [00:22&lt;00:01,  3.53it/s]
unique cpu indices calculation...:  94%|#########3| 90/96 [00:22&lt;00:01,  3.56it/s]
unique cpu indices calculation...:  95%|#########4| 91/96 [00:22&lt;00:01,  2.79it/s]
unique cpu indices calculation...:  96%|#########5| 92/96 [00:23&lt;00:01,  2.38it/s]
unique cpu indices calculation...:  97%|#########6| 93/96 [00:23&lt;00:01,  2.78it/s]
unique cpu indices calculation...:  98%|#########7| 94/96 [00:23&lt;00:00,  3.14it/s]
unique cpu indices calculation...:  99%|#########8| 95/96 [00:24&lt;00:00,  3.47it/s]
unique cpu indices calculation...: 100%|##########| 96/96 [00:24&lt;00:00,  3.79it/s]
unique cpu indices calculation...: 100%|##########| 96/96 [00:24&lt;00:00,  3.95it/s]
Elapsed time is 24.3 seconds
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot; ===========================================================================</span>
<span class="sd">                 Multi CPU</span>
<span class="sd">============================================================================&quot;&quot;&quot;</span>
<span class="c1"># At least 2 CPUs will be used in parallel and the files to process will be</span>
<span class="c1"># distributed on each CPU depending on their availability. This will speed up</span>
<span class="c1"># the process.</span>

<span class="c1"># create an empty dataframe. It will contain all ROIs found for each</span>
<span class="c1"># audio file in the directory</span>
<span class="n">df_indices</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="c1"># Number of CPU used for the calculation.</span>
<a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">nb_cpu</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/os.html#os.cpu_count" title="os.cpu_count" class="sphx-glr-backref-module-os sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span></a><span class="p">()</span>

<a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">tic</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/time.html#time.perf_counter" title="time.perf_counter" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span></a><span class="p">()</span>
<span class="c1"># Multicpu process</span>
<span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;multi cpu indices calculation...&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
    <span class="k">with</span> <a href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.ProcessPoolExecutor" title="concurrent.futures.ProcessPoolExecutor" class="sphx-glr-backref-module-concurrent-futures sphx-glr-backref-type-py-class"><span class="n">futures</span><span class="o">.</span><span class="n">ProcessPoolExecutor</span></a><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">nb_cpu</span></a><span class="p">)</span> <span class="k">as</span> <a href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.ProcessPoolExecutor" title="concurrent.futures.ProcessPoolExecutor" class="sphx-glr-backref-module-concurrent-futures sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pool</span></a><span class="p">:</span>
        <span class="c1"># give the function to map on several CPUs as well its arguments as</span>
        <span class="c1"># as list</span>
        <span class="k">for</span> <span class="n">df_indices_temp</span> <span class="ow">in</span> <a href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Executor.map" title="concurrent.futures.Executor.map" class="sphx-glr-backref-module-concurrent-futures sphx-glr-backref-type-py-method"><span class="n">pool</span><span class="o">.</span><span class="n">map</span></a><span class="p">(</span>
            <span class="n">single_file_processing</span><span class="p">,</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">df_indices</span> <span class="o">=</span> <span class="n">df_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_indices_temp</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">toc</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/time.html#time.perf_counter" title="time.perf_counter" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span></a><span class="p">()</span>

<span class="c1"># time duration of the process</span>
<a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">multicpu_duration</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">toc</span></a> <span class="o">-</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">tic</span></a>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Elapsed time is </span><span class="si">{</span><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">multicpu_duration</span></a><span class="si">:</span><span class="s2">0.1f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>multi cpu indices calculation...:   0%|          | 0/96 [00:00&lt;?, ?it/s]
multi cpu indices calculation...:   1%|1         | 1/96 [00:00&lt;00:38,  2.47it/s]
multi cpu indices calculation...:   5%|5         | 5/96 [00:00&lt;00:10,  8.43it/s]
multi cpu indices calculation...:   9%|9         | 9/96 [00:00&lt;00:07, 10.91it/s]
multi cpu indices calculation...:  14%|#3        | 13/96 [00:01&lt;00:06, 12.24it/s]
multi cpu indices calculation...:  18%|#7        | 17/96 [00:01&lt;00:06, 12.39it/s]
multi cpu indices calculation...:  22%|##1       | 21/96 [00:01&lt;00:05, 12.61it/s]
multi cpu indices calculation...:  26%|##6       | 25/96 [00:02&lt;00:05, 12.66it/s]
multi cpu indices calculation...:  30%|###       | 29/96 [00:02&lt;00:05, 12.78it/s]
multi cpu indices calculation...:  32%|###2      | 31/96 [00:02&lt;00:04, 13.30it/s]
multi cpu indices calculation...:  34%|###4      | 33/96 [00:02&lt;00:05, 12.36it/s]
multi cpu indices calculation...:  38%|###7      | 36/96 [00:02&lt;00:04, 14.23it/s]
multi cpu indices calculation...:  40%|###9      | 38/96 [00:03&lt;00:04, 11.98it/s]
multi cpu indices calculation...:  43%|####2     | 41/96 [00:03&lt;00:04, 11.28it/s]
multi cpu indices calculation...:  45%|####4     | 43/96 [00:03&lt;00:04, 12.53it/s]
multi cpu indices calculation...:  47%|####6     | 45/96 [00:03&lt;00:04, 11.32it/s]
multi cpu indices calculation...:  50%|#####     | 48/96 [00:03&lt;00:03, 14.22it/s]
multi cpu indices calculation...:  52%|#####2    | 50/96 [00:04&lt;00:03, 13.43it/s]
multi cpu indices calculation...:  54%|#####4    | 52/96 [00:04&lt;00:03, 14.33it/s]
multi cpu indices calculation...:  56%|#####6    | 54/96 [00:04&lt;00:03, 12.93it/s]
multi cpu indices calculation...:  59%|#####9    | 57/96 [00:04&lt;00:03, 11.44it/s]
multi cpu indices calculation...:  62%|######2   | 60/96 [00:05&lt;00:03, 10.57it/s]
multi cpu indices calculation...:  67%|######6   | 64/96 [00:05&lt;00:03, 10.20it/s]
multi cpu indices calculation...:  71%|#######   | 68/96 [00:05&lt;00:02, 11.03it/s]
multi cpu indices calculation...:  74%|#######3  | 71/96 [00:06&lt;00:02, 10.28it/s]
multi cpu indices calculation...:  78%|#######8  | 75/96 [00:06&lt;00:02,  9.26it/s]
multi cpu indices calculation...:  82%|########2 | 79/96 [00:06&lt;00:01, 11.79it/s]
multi cpu indices calculation...:  84%|########4 | 81/96 [00:06&lt;00:01, 12.18it/s]
multi cpu indices calculation...:  86%|########6 | 83/96 [00:07&lt;00:01, 12.36it/s]
multi cpu indices calculation...:  89%|########8 | 85/96 [00:07&lt;00:00, 12.55it/s]
multi cpu indices calculation...:  91%|######### | 87/96 [00:07&lt;00:00, 12.94it/s]
multi cpu indices calculation...:  93%|#########2| 89/96 [00:07&lt;00:00, 13.56it/s]
multi cpu indices calculation...:  95%|#########4| 91/96 [00:07&lt;00:00, 13.44it/s]
multi cpu indices calculation...:  97%|#########6| 93/96 [00:07&lt;00:00, 13.52it/s]
multi cpu indices calculation...:  99%|#########8| 95/96 [00:07&lt;00:00, 14.67it/s]
multi cpu indices calculation...: 100%|##########| 96/96 [00:07&lt;00:00, 12.02it/s]
Elapsed time is 8.0 seconds
</pre></div>
</div>
</section>
<section id="display-the-comparison-between-to-methods">
<h2>Display the comparison between to methods<a class="headerlink" href="#display-the-comparison-between-to-methods" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;ggplot&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># bar graphs</span>
<a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a> <span class="o">=</span> <span class="mf">0.75</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">x</span></a> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sequential (mono CPU)&#39;</span><span class="p">,</span> <span class="s1">&#39;parallel (multi CPU)&#39;</span><span class="p">]</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y</span></a> <span class="o">=</span> <span class="p">[</span><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">monocpu_duration</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">multicpu_duration</span></a><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">x</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">,</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Elapsed time (s)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Comparison between sequential</span><span class="se">\n</span><span class="s2"> and parallel processing&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img alt="Comparison between sequential  and parallel processing" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_extract_alpha_indices_multicpu_001.png" />
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  33.384 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-2-advanced-plot-extract-alpha-indices-multicpu-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/e833b96312dc32d633a48b9bb3ef1c8b/plot_extract_alpha_indices_multicpu.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_extract_alpha_indices_multicpu.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/58713de684267ae3435892eb4092c004/plot_extract_alpha_indices_multicpu.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_extract_alpha_indices_multicpu.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="wookpecker_drumming_characteristics.html" class="btn btn-neutral float-right" title="Download audio files from Xeno-Canto and automatically extract characteristics" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="plot_extract_alpha_indices.html" class="btn btn-neutral float-left" title="Extract acoustic indices from audio recordings" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2021, scikit-maad development team

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    

  <style>
         .wy-nav-content { max-width: none; }
  </style>



</body>
</html>